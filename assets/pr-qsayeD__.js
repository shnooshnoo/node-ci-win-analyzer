import{g as D,r as u,j as e,B as U,L as P}from"./index-VzPXNjlQ.js";import{g as J,C as F,P as N,T as R,a as I,b as H,c as O,d as j,e as $}from"./api-H4QwQr9D.js";import{L as g,B as q}from"./BarChart-fdXiX2K8.js";import{T as z}from"./TextField-4nYTEAFd.js";var E={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(n){(function(){var b={}.hasOwnProperty;function c(){for(var f=[],o=0;o<arguments.length;o++){var a=arguments[o];if(a){var t=typeof a;if(t==="string"||t==="number")f.push(a);else if(Array.isArray(a)){if(a.length){var i=c.apply(null,a);i&&f.push(i)}}else if(t==="object"){if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]")){f.push(a.toString());continue}for(var d in a)b.call(a,d)&&a[d]&&f.push(d)}}}return f.join(" ")}n.exports?(c.default=c,n.exports=c):window.classNames=c})()})(E);var G=E.exports;const K=D(G),M=({stats:n})=>{const[b,c]=u.useState([]),[f,o]=u.useState([]);return u.useEffect(()=>{if(n!==null){const a=[];for(let[t,i]of Object.entries(n))a.push({date:t,value:parseFloat((i.winOnly*100/i.total).toFixed(2))});a.sort((t,i)=>t.date>i.date?1:-1),c(a.map(t=>t.date)),o(a.map(t=>t.value))}},[n]),b.length===0?null:e.jsxs("div",{children:[e.jsx("h4",{children:"Windows-only failures share (builds)"}),e.jsx(g,{xAxis:[{id:"Date",data:b,scaleType:"point"}],series:[{data:f}],width:500,height:300})]})},Q=({stats:n})=>{const[b,c]=u.useState([]),[f,o]=u.useState([]);return u.useEffect(()=>{if(n!==null){const a=[];for(let[t,i]of Object.entries(n))a.push({date:t,value:parseFloat((i.win*100/i.totalFailures).toFixed(2))});a.sort((t,i)=>t.date>i.date?1:-1),c(a.map(t=>t.date)),o(a.map(t=>t.value))}},[n]),b.length===0?null:e.jsxs("div",{children:[e.jsx("h4",{children:"Windows failures share (jobs)"}),e.jsx(g,{xAxis:[{id:"Date",data:b,scaleType:"point"}],series:[{data:f}],width:500,height:300})]})},V=({builds:n,includeUnstable:b})=>{const[c,f]=u.useState(null);if(u.useEffect(()=>{const o={};for(let i of n)for(let d of i.subBuilds)for(let S of d.build.subBuilds)if(S.jobName==="node-test-commit-windows-fanned"&&S.result!=="SUCCESS"&&S.phases)for(let m of S.phases)m.result!=="SUCCESS"&&(!b&&m.result==="UNSTABLE"||(o[m.jobName]===void 0&&(o[m.jobName]=0),o[m.jobName]++));const a=Object.values(o).reduce((i,d)=>i+d,0),t=Object.keys(o);t.sort(),t.length&&f({names:t,values:t.map(i=>parseFloat((o[i]*100/a).toFixed(2)))})},[n,b]),c!==null)return e.jsxs("div",{children:[e.jsx("h4",{children:"Windows failures breakdown by phase, %"}),e.jsx(q,{xAxis:[{scaleType:"band",data:c.names}],series:[{data:c.values}],width:500,height:300})]})},X="_container_1forb_1",Y="_statsContainer_1forb_9",y="_tableHeaderCell_1forb_21",Z="_filterBox_1forb_29",ee="_chartsContainer_1forb_41",se="_failedWinBuild_1forb_49";const te="_unstableWinBuild_1forb_65";const ae="_nestedList_1forb_81";const oe=()=>{const[n,b]=u.useState(!1),[c,f]=u.useState(!1),[o,a]=u.useState(""),[t,i]=u.useState(null),[d,S]=u.useState({}),[m,A]=u.useState([]),[T,v]=u.useState([]),B=u.useCallback(r=>n?r==="FAILURE"||r==="UNSTABLE":r==="FAILURE",[n]);u.useEffect(()=>{J(n).then(({data:r})=>{A(r);const s={};for(let l of r){s[l.date]||(s[l.date]={total:0,totalFailures:0,totalJobs:0,win:0,winShare:0,winOnly:0,winOnlyShare:0});for(let h of l.subBuilds){s[l.date].total++;let x=!0,p=!0;for(let w of h.build.subBuilds)s[l.date].totalJobs++,B(w.result)?(s[l.date].totalFailures++,w.jobName==="node-test-commit-windows-fanned"?s[l.date].win++:x=!1):p=!1;x&&!p&&s[l.date].winOnly++}s[l.date].winShare=(s[l.date].win*100/s[l.date].totalFailures).toFixed(2),s[l.date].winOnlyShare=(s[l.date].winOnly*100/s[l.date].total).toFixed(2)}i(s)})},[n,B]),u.useEffect(()=>{const r=m.map(l=>o.length&&l.date!==o?null:l).filter(l=>l!==null);v(r.slice(0,50));const s=r.reduce((l,h)=>{const x={...l};for(let p of h.subBuilds){x.total++;let w=!0,_=!0;for(let C of p.build.subBuilds)x.totalJobs++,B(C.result)?(x.totalFailures++,C.jobName==="node-test-commit-windows-fanned"?x.win++:w=!1):_=!1;w&&!_&&x.winOnly++}return x},{total:0,totalFailures:0,totalJobs:0,win:0,winShare:0,winOnly:0,winOnlyShare:0});s.winShare=(s.win*100/s.totalFailures).toFixed(2),s.winOnlyShare=(s.winOnly*100/s.total).toFixed(2),S(s)},[m,o,v,B]);const W=r=>{a(r.target.value.trim())},L=(r,s)=>{b(s)},k=(r,s)=>{f(s)};return e.jsxs("div",{className:X,children:[e.jsx(U,{component:P,to:"/",children:"Back"}),e.jsxs("div",{className:ee,children:[e.jsx(Q,{stats:t}),e.jsx(M,{stats:t}),e.jsx(V,{builds:m,includeUnstable:n})]}),e.jsx("div",{className:Z,children:e.jsx(z,{id:"standard-basic",label:"Date",variant:"standard",value:o,onChange:W})}),e.jsxs("div",{children:[e.jsx(F,{checked:n,onChange:L}),"Include unstable"]}),e.jsxs("div",{children:[e.jsx(F,{checked:c,onChange:k}),"Show phases"]}),e.jsxs("div",{className:Y,children:[e.jsxs("span",{children:["Total builds failed: ",d.total]}),e.jsxs("span",{children:["Windows-only failures (builds): ",d.winOnly]}),e.jsxs("span",{children:["Windows-only failures share (builds): ",d.winOnlyShare,"% (",d.winOnly," / ",d.total,")"]}),e.jsxs("span",{children:["Total jobs: ",d.totalJobs]}),e.jsxs("span",{children:["Total jobs failed: ",d.totalFailures]}),e.jsxs("span",{children:["Windows failures (jobs): ",d.win]}),e.jsxs("span",{children:["Windows failures share (jobs): ",d.winShare,"% (",d.win," / ",d.totalFailures,")"]})]}),e.jsx(N,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(R,{component:N,children:e.jsxs(I,{stickyHeader:!0,size:"small","aria-label":"a dense table",children:[e.jsx(H,{children:e.jsxs(O,{children:[e.jsx(j,{className:y,children:"Build"}),e.jsx(j,{className:y,children:"Job Name"}),e.jsx(j,{className:y,children:"Date"}),e.jsx(j,{className:y,children:"PR"}),e.jsx(j,{className:y,children:"Failed jobs"})]})}),e.jsx($,{children:T.map(r=>r.subBuilds.map((s,l)=>e.jsxs(O,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(j,{component:"th",scope:"row",children:e.jsx("a",{href:`https://ci.nodejs.org/job/node-test-pull-request/${r.id}/`,target:"_blank",rel:"noreferrer",children:r.id})}),e.jsx(j,{children:s.jobName}),e.jsx(j,{children:r.date}),e.jsx(j,{children:e.jsx("a",{href:`https://github.com/nodejs/node/pull/${r.prId}/`,target:"_blank",rel:"noreferrer",children:r.prId})}),e.jsx(j,{children:e.jsxs("ul",{children:[s.build.subBuilds.length===0&&e.jsx("li",{children:s.jobName}),s.build.subBuilds.filter(h=>B(h.result)).map((h,x)=>e.jsxs("li",{children:[e.jsxs("span",{className:K({[se]:h.jobName==="node-test-commit-windows-fanned"&&h.result==="FAILURE",[te]:h.jobName==="node-test-commit-windows-fanned"&&h.result==="UNSTABLE"}),children:[h.jobName," (",h.result,")"]}),c&&h.phases&&h.result==="FAILURE"&&e.jsx("ul",{className:ae,children:h.phases.map((p,w)=>p.result!=="SUCCESS"?e.jsx("li",{children:p.jobName},w):null)})]},x))]})})]},l)))})]})})})]})};export{oe as PRs};
