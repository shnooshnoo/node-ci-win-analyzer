import{j as e,r as i,B as I,L as y}from"./index-8rFDYOGY.js";import{f as z,P as j,T as p,a as g,b as T,c as u,d as s,e as D,g as f}from"./api-DXQC4Q-b.js";const r="_tableHeaderCell_3rkz9_1",E="_filterBox_3rkz9_5";const O=({callStack:d})=>{const n=d[d.length-1];return n.prId?e.jsxs("a",{target:"_blank",rel:"noreferrer",href:`https://github.com/nodejs/node/pull/${n.prId}`,children:["PR ",n.prId]}):e.jsxs("a",{href:`https://ci.nodejs.org/${n.upstreamUrl}${n.upstreamBuild}`,target:"_blank",rel:"noreferrer",children:[n.upstreamProject,", ",n.upstreamBuild]})},R=()=>{const[d,n]=i.useState([]),[S,k]=i.useState([]),[v,b]=i.useState([]),[h,C]=i.useState(""),[m,B]=i.useState(""),[x,_]=i.useState("");i.useEffect(()=>{z().then(({data:t})=>{n(t)})},[]),i.useEffect(()=>{const t=Date.now()-12096e5,c=d.reduce((a,l)=>l.timestamp<t?a:{...a,[l.testName]:a[l.testName]?a[l.testName]+1:1},{}),N=Object.entries(c);N.sort((a,l)=>a[1]>l[1]?-1:1),k(N.slice(0,10)),b(d.map(a=>{if(h.length&&!a.testName.includes(h))return null;if(m.length){const l=new Date(a.timestamp).getTime(),o=new Date(m).getTime();if(isNaN(l)||isNaN(o)||l<o)return null}if(x.length){const l=new Date(a.timestamp).getTime(),o=new Date(x).getTime();if(isNaN(l)||isNaN(o)||l>o)return null}return a}).filter(a=>a!==null).slice(0,100))},[d,m,x,b,h]);const F=t=>{C(t.target.value.trim())},w=t=>{B(t.target.value.trim())},H=t=>{_(t.target.value.trim())};return e.jsxs(e.Fragment,{children:[e.jsx(I,{component:y,to:"/",children:"Back"}),e.jsx("h4",{children:"Most failed tests"}),e.jsx(j,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(p,{component:j,children:e.jsxs(g,{stickyHeader:!0,size:"small","aria-label":"a dense table",children:[e.jsx(T,{children:e.jsxs(u,{children:[e.jsx(s,{className:r,children:"Test name"}),e.jsx(s,{className:r,children:"Number of failures in the past two weeks"})]})}),e.jsx(D,{children:S.map((t,c)=>e.jsxs(u,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(s,{component:"th",scope:"row",children:t[0]}),e.jsx(s,{children:t[1]})]},c))})]})})}),e.jsx("h4",{children:"All test failures"}),e.jsxs("div",{className:E,children:[e.jsx(f,{id:"standard-basic",label:"Name",variant:"standard",value:h,onChange:F}),e.jsx(f,{id:"standard-basic",label:"Date from",variant:"standard",value:m,onChange:w}),e.jsx(f,{id:"standard-basic",label:"Date to",variant:"standard",value:x,onChange:H})]}),e.jsx(j,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(p,{component:j,children:e.jsxs(g,{stickyHeader:!0,size:"small","aria-label":"a dense table",children:[e.jsx(T,{children:e.jsxs(u,{children:[e.jsx(s,{className:r,children:"#"}),e.jsx(s,{className:r,children:"Test name"}),e.jsx(s,{className:r,children:"Job"}),e.jsx(s,{className:r,children:"Config"}),e.jsx(s,{className:r,children:"Status"}),e.jsx(s,{className:r,children:"Node"}),e.jsx(s,{className:r,sx:{minWidth:75},children:"Date"}),e.jsx(s,{className:r,children:"Build"}),e.jsx(s,{className:r,children:"Built On"}),e.jsx(s,{className:r,children:"Source"})]})}),e.jsx(D,{children:v.map((t,c)=>e.jsxs(u,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(s,{component:"th",scope:"row",children:c+1}),e.jsx(s,{children:t.testName}),e.jsx(s,{children:t.jobName}),e.jsx(s,{children:t.config}),e.jsx(s,{children:t.status}),e.jsx(s,{children:t.nodeVersion}),e.jsx(s,{sx:{minWidth:200},children:new Date(t.timestamp).toISOString()}),e.jsx(s,{children:e.jsx("a",{href:t.buildUrl,target:"_blank",rel:"noreferrer",children:t.buildNumber})}),e.jsx(s,{children:t.builtOn}),e.jsx(s,{children:e.jsx(O,{callStack:t.callStack})})]},c))})]})})})]})};export{R as Tests};
