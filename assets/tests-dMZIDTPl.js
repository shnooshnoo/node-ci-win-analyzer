import{j as e,r as o,B as W,L as $}from"./index-gCJOKWPp.js";import{f as L,C as k,P as x,T as y,a as F,b as C,c as j,d as t,e as I,g as N}from"./api-43EDDs-8.js";const r="_tableHeaderCell_3rkz9_1",U="_filterBox_3rkz9_5";const J=({callStack:l})=>{const i=l[l.length-1];return i.prId?e.jsxs("a",{target:"_blank",rel:"noreferrer",href:`https://github.com/nodejs/node/pull/${i.prId}`,children:["PR ",i.prId]}):e.jsxs("a",{href:`https://ci.nodejs.org/${i.upstreamUrl}${i.upstreamBuild}`,target:"_blank",rel:"noreferrer",children:[i.upstreamProject,", ",i.upstreamBuild]})},f=l=>{var i;return typeof((i=l==null?void 0:l.tap)==null?void 0:i.todo)!="string"?!1:l.tap.todo.includes("Fix flaky test")},M=({count:l})=>l?e.jsxs("span",{children:["(",l," flaky)"]}):null,q=()=>{const[l,i]=o.useState([]),[S,D]=o.useState([]),[v,T]=o.useState([]),[h,B]=o.useState(""),[u,_]=o.useState(""),[m,H]=o.useState(""),[b,w]=o.useState(!0),[p,z]=o.useState(!0);o.useEffect(()=>{L().then(({data:s})=>{i(s)})},[]),o.useEffect(()=>{const s=Date.now()-12096e5,d=l.reduce((n,a)=>{if(a.timestamp<s||!b&&f(a))return n;const c={...n};return c[a.testName]===void 0&&(c[a.testName]={failures:0,flakyFailures:0}),c[a.testName].failures++,f(a)&&c[a.testName].flakyFailures++,c},{}),g=Object.entries(d);g.sort((n,a)=>n[1].failures>a[1].failures?-1:1),D(g.slice(0,10)),T(l.map(n=>{if(h.length&&!n.testName.includes(h))return null;if(u.length){const a=new Date(n.timestamp).getTime(),c=new Date(u).getTime();if(isNaN(a)||isNaN(c)||a<c)return null}if(m.length){const a=new Date(n.timestamp).getTime(),c=new Date(m).getTime();if(isNaN(a)||isNaN(c)||a>c)return null}return!p&&f(n)?null:n}).filter(n=>n!==null).slice(0,100))},[l,u,m,b,p,T,h]);const E=s=>{B(s.target.value.trim())},O=s=>{_(s.target.value.trim())},P=s=>{H(s.target.value.trim())},A=(s,d)=>{w(d)},R=(s,d)=>{z(d)};return e.jsxs(e.Fragment,{children:[e.jsx(W,{component:$,to:"/",children:"Back"}),e.jsx("h4",{children:"Most failed tests"}),e.jsx(k,{checked:b,onChange:A}),"Include flaky tests",e.jsx(x,{sx:{width:1200,overflow:"hidden"},children:e.jsx(y,{component:x,children:e.jsxs(F,{stickyHeader:!0,size:"small","aria-label":"a dense table",children:[e.jsx(C,{children:e.jsxs(j,{children:[e.jsx(t,{className:r,children:"Test name"}),e.jsx(t,{className:r,children:"Number of failures in the past two weeks"})]})}),e.jsx(I,{children:S.map((s,d)=>e.jsxs(j,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{component:"th",scope:"row",children:s[0]}),e.jsxs(t,{children:[s[1].failures," ",e.jsx(M,{count:s[1].flakyFailures})]})]},d))})]})})}),e.jsx("h4",{children:"All test failures"}),e.jsxs("div",{className:U,children:[e.jsx(N,{id:"standard-basic",label:"Name",variant:"standard",value:h,onChange:E}),e.jsx(N,{id:"standard-basic",label:"Date from",variant:"standard",value:u,onChange:O}),e.jsx(N,{id:"standard-basic",label:"Date to",variant:"standard",value:m,onChange:P}),e.jsxs("div",{children:[e.jsx(k,{checked:p,onChange:R}),"Include flaky tests"]})]}),e.jsx(x,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(y,{component:x,children:e.jsxs(F,{stickyHeader:!0,size:"small","aria-label":"a dense table",children:[e.jsx(C,{children:e.jsxs(j,{children:[e.jsx(t,{className:r,children:"#"}),e.jsx(t,{className:r,children:"Test name"}),e.jsx(t,{className:r,children:"Is Flaky"}),e.jsx(t,{className:r,children:"Job"}),e.jsx(t,{className:r,children:"Config"}),e.jsx(t,{className:r,children:"Status"}),e.jsx(t,{className:r,children:"Node"}),e.jsx(t,{className:r,sx:{minWidth:75},children:"Date"}),e.jsx(t,{className:r,children:"Build"}),e.jsx(t,{className:r,children:"Built On"}),e.jsx(t,{className:r,children:"Source"})]})}),e.jsx(I,{children:v.map((s,d)=>e.jsxs(j,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{component:"th",scope:"row",children:d+1}),e.jsx(t,{children:s.testName}),e.jsx(t,{children:f(s)?"Yes":"No"}),e.jsx(t,{children:s.jobName}),e.jsx(t,{children:s.config}),e.jsx(t,{children:s.status}),e.jsx(t,{children:s.nodeVersion}),e.jsx(t,{sx:{minWidth:200},children:new Date(s.timestamp).toISOString()}),e.jsx(t,{children:e.jsx("a",{href:s.buildUrl,target:"_blank",rel:"noreferrer",children:s.buildNumber})}),e.jsx(t,{children:s.builtOn}),e.jsx(t,{children:e.jsx(J,{callStack:s.callStack})})]},d))})]})})})]})};export{q as Tests};
