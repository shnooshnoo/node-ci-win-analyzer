import{a as K,b as fe,s as be,i as Ue,h as We,_ as F,k as se,r as L,u as Ee,c as G,l as _e,m as ze,j as s,d as ve,f as xe,B as X,L as Ve}from"./index-ZqlGjTf3.js";import{L as Re,P as Ae,T as Qe,a as Ge,b as qe,c as Te,d as q,e as Xe,f as Ye,g as Ke,S as ce,C as ue}from"./api-tpD4wwYb.js";import{w as Ze,h as Se,e as U,t as et,c as Q,s as E,m as ge,a as De,p as Ce,b as Y,d as H,f as z,g as ke,i as tt,j as st,L as ye,k as Je,u as nt,l as pe,I as it,n as at,o as lt,q as Fe,S as rt,D as ot,R as dt,r as ct,C as ut,v as gt,x as ht,y as pt,B as me}from"./BarChart-Y3AQjq_T.js";function mt(t){return t.innerRadius}function ft(t){return t.outerRadius}function bt(t){return t.startAngle}function xt(t){return t.endAngle}function yt(t){return t&&t.padAngle}function wt(t,a,r,g,o,p,c,u){var l=r-t,h=g-a,i=c-o,j=u-p,m=j*l-i*h;if(!(m*m<U))return m=(i*(a-p)-j*(t-o))/m,[t+m*l,a+m*h]}function ne(t,a,r,g,o,p,c){var u=t-r,l=a-g,h=(c?p:-p)/Y(u*u+l*l),i=h*l,j=-h*u,m=t+i,x=a+j,b=r+i,v=g+j,C=(m+b)/2,y=(x+v)/2,w=b-m,T=v-x,R=w*w+T*T,k=o-p,I=m*v-b*x,$=(T<0?-1:1)*Y(st(0,k*k*R-I*I)),M=(I*T-w*$)/R,B=(-I*w-T*$)/R,S=(I*T+w*$)/R,O=(-I*w+T*$)/R,J=M-C,d=B-y,e=S-C,n=O-y;return J*J+d*d>e*e+n*n&&(M=S,B=O),{cx:M,cy:B,x01:-i,y01:-j,x11:M*(o/k-1),y11:B*(o/k-1)}}function Be(){var t=mt,a=ft,r=z(0),g=null,o=bt,p=xt,c=yt,u=null,l=Ze(h);function h(){var i,j,m=+t.apply(this,arguments),x=+a.apply(this,arguments),b=o.apply(this,arguments)-Se,v=p.apply(this,arguments)-Se,C=De(v-b),y=v>b;if(u||(u=i=l()),x<m&&(j=x,x=m,m=j),!(x>U))u.moveTo(0,0);else if(C>et-U)u.moveTo(x*Q(b),x*E(b)),u.arc(0,0,x,b,v,!y),m>U&&(u.moveTo(m*Q(v),m*E(v)),u.arc(0,0,m,v,b,y));else{var w=b,T=v,R=b,k=v,I=C,$=C,M=c.apply(this,arguments)/2,B=M>U&&(g?+g.apply(this,arguments):Y(m*m+x*x)),S=ge(De(x-m)/2,+r.apply(this,arguments)),O=S,J=S,d,e;if(B>U){var n=ke(B/m*E(M)),A=ke(B/x*E(M));(I-=n*2)>U?(n*=y?1:-1,R+=n,k-=n):(I=0,R=k=(b+v)/2),($-=A*2)>U?(A*=y?1:-1,w+=A,T-=A):($=0,w=T=(b+v)/2)}var N=x*Q(w),P=x*E(w),W=m*Q(k),D=m*E(k);if(S>U){var V=x*Q(T),te=x*E(T),ie=m*Q(R),ae=m*E(R),_;if(C<Ce)if(_=wt(N,P,ie,ae,V,te,W,D)){var le=N-_[0],re=P-_[1],oe=V-_[0],de=te-_[1],we=1/E(tt((le*oe+re*de)/(Y(le*le+re*re)*Y(oe*oe+de*de)))/2),je=Y(_[0]*_[0]+_[1]*_[1]);O=ge(S,(m-je)/(we-1)),J=ge(S,(x-je)/(we+1))}else O=J=0}$>U?J>U?(d=ne(ie,ae,N,P,x,J,y),e=ne(V,te,W,D,x,J,y),u.moveTo(d.cx+d.x01,d.cy+d.y01),J<S?u.arc(d.cx,d.cy,J,H(d.y01,d.x01),H(e.y01,e.x01),!y):(u.arc(d.cx,d.cy,J,H(d.y01,d.x01),H(d.y11,d.x11),!y),u.arc(0,0,x,H(d.cy+d.y11,d.cx+d.x11),H(e.cy+e.y11,e.cx+e.x11),!y),u.arc(e.cx,e.cy,J,H(e.y11,e.x11),H(e.y01,e.x01),!y))):(u.moveTo(N,P),u.arc(0,0,x,w,T,!y)):u.moveTo(N,P),!(m>U)||!(I>U)?u.lineTo(W,D):O>U?(d=ne(W,D,V,te,m,-O,y),e=ne(N,P,ie,ae,m,-O,y),u.lineTo(d.cx+d.x01,d.cy+d.y01),O<S?u.arc(d.cx,d.cy,O,H(d.y01,d.x01),H(e.y01,e.x01),!y):(u.arc(d.cx,d.cy,O,H(d.y01,d.x01),H(d.y11,d.x11),!y),u.arc(0,0,m,H(d.cy+d.y11,d.cx+d.x11),H(e.cy+e.y11,e.cx+e.x11),y),u.arc(e.cx,e.cy,O,H(e.y11,e.x11),H(e.y01,e.x01),!y))):u.arc(0,0,m,k,R,y)}if(u.closePath(),i)return u=null,i+""||null}return h.centroid=function(){var i=(+t.apply(this,arguments)+ +a.apply(this,arguments))/2,j=(+o.apply(this,arguments)+ +p.apply(this,arguments))/2-Ce/2;return[Q(j)*i,E(j)*i]},h.innerRadius=function(i){return arguments.length?(t=typeof i=="function"?i:z(+i),h):t},h.outerRadius=function(i){return arguments.length?(a=typeof i=="function"?i:z(+i),h):a},h.cornerRadius=function(i){return arguments.length?(r=typeof i=="function"?i:z(+i),h):r},h.padRadius=function(i){return arguments.length?(g=i==null?null:typeof i=="function"?i:z(+i),h):g},h.startAngle=function(i){return arguments.length?(o=typeof i=="function"?i:z(+i),h):o},h.endAngle=function(i){return arguments.length?(p=typeof i=="function"?i:z(+i),h):p},h.padAngle=function(i){return arguments.length?(c=typeof i=="function"?i:z(+i),h):c},h.context=function(i){return arguments.length?(u=i??null,h):u},h}const jt=K("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]),Ne=jt,vt=K("MuiListItemIcon",["root","alignItemsFlexStart"]),Oe=vt,Rt=K("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]),Ie=Rt;function At(t){return fe("MuiMenuItem",t)}const Tt=K("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),Z=Tt,St=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],Dt=(t,a)=>{const{ownerState:r}=t;return[a.root,r.dense&&a.dense,r.divider&&a.divider,!r.disableGutters&&a.gutters]},Ct=t=>{const{disabled:a,dense:r,divider:g,disableGutters:o,selected:p,classes:c}=t,l=xe({root:["root",r&&"dense",a&&"disabled",!o&&"gutters",g&&"divider",p&&"selected"]},At,c);return F({},c,l)},kt=be(Ue,{shouldForwardProp:t=>We(t)||t==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:Dt})(({theme:t,ownerState:a})=>F({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!a.disableGutters&&{paddingLeft:16,paddingRight:16},a.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Z.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:se(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${Z.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:se(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${Z.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:se(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:se(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${Z.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${Z.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${Ne.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${Ne.inset}`]:{marginLeft:52},[`& .${Ie.root}`]:{marginTop:0,marginBottom:0},[`& .${Ie.inset}`]:{paddingLeft:36},[`& .${Oe.root}`]:{minWidth:36}},!a.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},a.dense&&F({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${Oe.root} svg`]:{fontSize:"1.25rem"}}))),Nt=L.forwardRef(function(a,r){const g=Ee({props:a,name:"MuiMenuItem"}),{autoFocus:o=!1,component:p="li",dense:c=!1,divider:u=!1,disableGutters:l=!1,focusVisibleClassName:h,role:i="menuitem",tabIndex:j,className:m}=g,x=G(g,St),b=L.useContext(Re),v=L.useMemo(()=>({dense:c||b.dense||!1,disableGutters:l}),[b.dense,c,l]),C=L.useRef(null);_e(()=>{o&&C.current&&C.current.focus()},[o]);const y=F({},g,{dense:v.dense,divider:u,disableGutters:l}),w=Ct(g),T=ze(C,r);let R;return g.disabled||(R=j!==void 0?j:-1),s.jsx(Re.Provider,{value:v,children:s.jsx(kt,F({ref:T,role:i,tabIndex:R,component:p,focusVisibleClassName:ve(w.focusVisible,h),className:ve(w.root,m)},x,{ownerState:y,classes:w}))})}),f=Nt,he="_tableHeaderCell_tnbpf_1",Ot="_container_tnbpf_9";const It=({includeFlaky:t,table:a,prs:r})=>{const g=c=>{const u={};for(const l of c){const h=new Date(l.timestamp).toLocaleDateString();u[h]||(u[h]=0),++u[h]}return u},o=c=>{{const l=`https://ci.nodejs.org/job/${c.length&&c[0].buildUrl.includes("job/node-test-binary-windows-js-suites")?"node-test-binary-windows-js-suites":"node-test-binary-windows-native-suites"}/`,h=[...new Set(c.map(j=>`${l}${j.buildNumber}`))],i=c.map(j=>j.buildUrl);return{builds:h,urls:i}}},p=c=>{{const u={};for(const i of r)u[i.prId]=i.id;const l=[];for(const i of c)i.callStack.length&&i.callStack[i.callStack.length-1].prId&&!l.includes(+i.callStack[i.callStack.length-1].prId)&&l.push(+i.callStack[i.callStack.length-1].prId);const h=l.map(i=>`https://github.com/nodejs/node/pull/${i}`);return{prs:l,urls:h}}};return s.jsx(Ae,{children:s.jsx(Qe,{component:Ae,children:s.jsxs(Ge,{stickyHeader:!0,size:"small","aria-label":"a dense table",children:[s.jsx(qe,{children:s.jsxs(Te,{children:[s.jsx(q,{className:he,children:"Name"}),s.jsxs(q,{className:he,children:["Failures",t?"(flaky)":""," / Builds / PRs"]}),s.jsx(q,{className:he,children:"Actions"})]})}),s.jsx(Xe,{children:a.map((c,u)=>s.jsxs(Te,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[s.jsx(q,{component:"th",scope:"row",children:c[0]}),s.jsxs(q,{children:[c[1].total,c[1].flaky?s.jsxs("span",{children:["(",c[1].flaky,")"]}):null," / ",c[1].builds.length," / ",c[1].prs.length]}),s.jsxs(q,{children:[s.jsx(X,{onClick:()=>{window.open(`https://github.com/nodejs/reliability/issues?q=is%3Aissue+is%3Aopen+${encodeURI(c[0])}`)},children:"Reliability"}),s.jsx(X,{onClick:()=>{console.clear(),console.log(c[0]),console.log(c[1].data)},children:"Data"}),s.jsx(X,{onClick:()=>{console.clear(),console.log(c[0]),console.log(g(c[1].data))},children:"Chart"}),s.jsx(X,{onClick:()=>{console.clear(),console.log(c[0]),console.log(o(c[1].data))},onDoubleClick:()=>{for(const l of o(c[1].data).builds)window.open(l)},children:"Builds"}),s.jsx(X,{onClick:()=>{console.clear(),console.log(c[0]),console.log(p(c[1].data))},onDoubleClick:()=>{for(const l of p(c[1].data).urls)window.open(l)},children:"PRs"})]})]},u))})]})})})},Pt=({chart:t})=>{const[a,r]=L.useState(window.innerWidth),g=()=>{r(window.innerWidth-32)};return window.addEventListener("resize",g),s.jsx("div",{children:s.jsx(ye,{xAxis:[{data:t.map(o=>o[0]),scaleType:"point"}],series:[{label:"Tests",data:t.map(o=>o[1].tests)},{label:"Builds",data:t.map(o=>o[1].builds.length)},{label:"PRs",data:t.map(o=>o[1].prs.length)}],width:a,height:500})})},Lt=({chart:t})=>{const[a,r]=L.useState(window.innerWidth),g=()=>{r(window.innerWidth-32)};return window.addEventListener("resize",g),s.jsx("div",{children:s.jsx(ye,{xAxis:[{data:Object.entries(t).map(o=>o[0]),scaleType:"point"}],series:[{label:"Builds",data:Object.entries(t).map(o=>o[1].builds.length)},{label:"PRs",data:Object.entries(t).map(o=>o[1].prs.length)}],width:a,height:500})})},$t=["id","dataIndex","classes","color","highlightScope","onClick","isFaded","isHighlighted","startAngle","endAngle","paddingAngle","innerRadius","outerRadius","cornerRadius"];function Mt(t){return fe("MuiPieArc",t)}K("MuiPieArc",["root","highlighted","faded"]);const Jt=t=>{const{classes:a,id:r,isFaded:g,isHighlighted:o}=t,p={root:["root",`series-${r}`,o&&"highlighted",g&&"faded"]};return xe(p,Mt,a)},Ft=be(Je.path,{name:"MuiPieArc",slot:"Root",overridesResolver:(t,a)=>a.arc})(({theme:t})=>({stroke:(t.vars||t).palette.background.paper,strokeWidth:1,strokeLinejoin:"round"}));function Bt(t){const{id:a,dataIndex:r,classes:g,color:o,highlightScope:p,onClick:c,isFaded:u,isHighlighted:l,startAngle:h,endAngle:i,paddingAngle:j,innerRadius:m,outerRadius:x,cornerRadius:b}=t,v=G(t,$t),C={id:a,dataIndex:r,classes:g,color:o,isFaded:u,isHighlighted:l},y=Jt(C),w=nt(p);return s.jsx(Ft,F({d:pe([h,i,j,m,x,b],(T,R,k,I,$,M)=>Be().cornerRadius(M)({padAngle:k,startAngle:T,endAngle:R,innerRadius:I,outerRadius:$})),onClick:c,cursor:c?"pointer":"unset",ownerState:C,className:y.root},v,w({type:"pie",seriesId:a,dataIndex:r})))}const Ht={keys:t=>t.id,from:({innerRadius:t,outerRadius:a,cornerRadius:r,startAngle:g,endAngle:o,paddingAngle:p,color:c,isFaded:u})=>({innerRadius:t,outerRadius:(t+a)/2,cornerRadius:r,startAngle:(g+o)/2,endAngle:(g+o)/2,paddingAngle:p,fill:c,opacity:u?.3:1}),leave:({innerRadius:t,startAngle:a,endAngle:r})=>({innerRadius:t,outerRadius:t,startAngle:(a+r)/2,endAngle:(a+r)/2}),enter:({innerRadius:t,outerRadius:a,startAngle:r,endAngle:g})=>({innerRadius:t,outerRadius:a,startAngle:r,endAngle:g}),update:({innerRadius:t,outerRadius:a,cornerRadius:r,startAngle:g,endAngle:o,paddingAngle:p,color:c,isFaded:u})=>({innerRadius:t,outerRadius:a,cornerRadius:r,startAngle:g,endAngle:o,paddingAngle:p,fill:c,opacity:u?.3:1}),config:{tension:120,friction:14,clamp:!0}},Ut={keys:t=>t.id,from:({innerRadius:t,outerRadius:a,cornerRadius:r,startAngle:g,endAngle:o,paddingAngle:p})=>({innerRadius:t,outerRadius:(t+a)/2,cornerRadius:r,startAngle:(g+o)/2,endAngle:(g+o)/2,paddingAngle:p,opacity:0}),leave:({innerRadius:t,startAngle:a,endAngle:r})=>({innerRadius:t,outerRadius:t,startAngle:(a+r)/2,endAngle:(a+r)/2,opacity:0}),enter:({innerRadius:t,outerRadius:a,startAngle:r,endAngle:g})=>({innerRadius:t,outerRadius:a,startAngle:r,endAngle:g,opacity:1}),update:({innerRadius:t,outerRadius:a,cornerRadius:r,startAngle:g,endAngle:o,paddingAngle:p})=>({innerRadius:t,outerRadius:a,cornerRadius:r,startAngle:g,endAngle:o,paddingAngle:p,opacity:1}),config:{tension:120,friction:14,clamp:!0}};function He(t){const{id:a,highlightScope:r,data:g,faded:o,highlighted:p,paddingAngle:c=0,innerRadius:u=0,outerRadius:l,cornerRadius:h=0}=t,{item:i}=L.useContext(it),j=L.useCallback(x=>{const b=at(i,{type:"pie",seriesId:a,dataIndex:x},r),v=!b&&lt(i,{type:"pie",seriesId:a,dataIndex:x},r);return{isHighlighted:b,isFaded:v}},[r,i,a]);return L.useMemo(()=>g.map((x,b)=>{var v,C,y,w;const{isHighlighted:T,isFaded:R}=j(b),k=F({additionalRadius:0},R&&o||T&&p||{}),I=Math.max(0,Math.PI*((v=k.paddingAngle)!=null?v:c)/180),$=Math.max(0,(C=k.innerRadius)!=null?C:u),M=Math.max(0,(y=k.outerRadius)!=null?y:l+k.additionalRadius),B=(w=k.cornerRadius)!=null?w:h;return F({},x,k,{isFaded:R,isHighlighted:T,paddingAngle:I,innerRadius:$,outerRadius:M,cornerRadius:B})}),[h,u,l,c,g,o,j,p])}const Wt=["slots","slotProps","innerRadius","outerRadius","cornerRadius","paddingAngle","id","highlightScope","highlighted","faded","data","onClick","skipAnimation"],Et=["startAngle","endAngle","paddingAngle","innerRadius","outerRadius","cornerRadius"];function _t(t){var a;const{slots:r,slotProps:g,innerRadius:o=0,outerRadius:p,cornerRadius:c=0,paddingAngle:u=0,id:l,highlightScope:h,highlighted:i,faded:j={additionalRadius:-5},data:m,onClick:x,skipAnimation:b}=t,v=G(t,Wt),C=He({innerRadius:o,outerRadius:p,cornerRadius:c,paddingAngle:u,id:l,highlightScope:h,highlighted:i,faded:j,data:m}),y=Fe(C,F({},Ht,{immediate:b}));if(m.length===0)return null;const w=(a=r==null?void 0:r.pieArc)!=null?a:Bt;return s.jsx("g",F({},v,{children:y((T,R,k,I)=>{let{startAngle:$,endAngle:M,paddingAngle:B,innerRadius:S,outerRadius:O,cornerRadius:J}=T,d=G(T,Et);return s.jsx(w,F({startAngle:$,endAngle:M,paddingAngle:B,innerRadius:S,outerRadius:O,cornerRadius:J,style:d,id:l,color:R.color,dataIndex:I,highlightScope:h,isFaded:R.isFaded,isHighlighted:R.isHighlighted,onClick:x&&(e=>{x(e,{type:"pie",seriesId:l,dataIndex:I},R)})},g==null?void 0:g.pieArc))})}))}const zt=["id","classes","color","startAngle","endAngle","paddingAngle","innerRadius","outerRadius","cornerRadius","formattedArcLabel","isHighlighted","isFaded","style"];function Vt(t){return fe("MuiPieArcLabel",t)}K("MuiPieArcLabel",["root","highlighted","faded"]);const Qt=t=>{const{classes:a,id:r,isFaded:g,isHighlighted:o}=t,p={root:["root",`series-${r}`,o&&"highlighted",g&&"faded"]};return xe(p,Vt,a)},Gt=be(Je.text,{name:"MuiPieArcLabel",slot:"Root",overridesResolver:(t,a)=>a.root})(({theme:t})=>({fill:(t.vars||t).palette.text.primary,textAnchor:"middle",dominantBaseline:"middle"})),Pe=(t,a)=>(r,g,o,p,c,u)=>{if(!t)return 0;const[l,h]=Be().cornerRadius(u).centroid({padAngle:o,startAngle:r,endAngle:g,innerRadius:p,outerRadius:c});return a==="x"?l:h};function qt(t){const{id:a,classes:r,color:g,startAngle:o,endAngle:p,paddingAngle:c,innerRadius:u,outerRadius:l,cornerRadius:h,formattedArcLabel:i,isHighlighted:j,isFaded:m,style:x}=t,b=G(t,zt),C=Qt({id:a,classes:r,color:g,isFaded:m,isHighlighted:j});return s.jsx(Gt,F({className:C.root},b,{style:F({x:pe([o,p,c,u,l,h],Pe(i,"x")),y:pe([o,p,c,u,l,h],Pe(i,"y"))},x),children:i}))}const Xt=["slots","slotProps","innerRadius","outerRadius","cornerRadius","paddingAngle","id","highlightScope","highlighted","faded","data","arcLabel","arcLabelMinAngle","skipAnimation"],Yt=["startAngle","endAngle","paddingAngle","innerRadius","outerRadius","cornerRadius"],Kt=180/Math.PI;function Zt(t,a,r){if(!t||(r.endAngle-r.startAngle)*Kt<a)return null;if(typeof t=="string"){var o;return(o=r[t])==null?void 0:o.toString()}return t(r)}function es(t){var a;const{slots:r,slotProps:g,innerRadius:o=0,outerRadius:p,cornerRadius:c=0,paddingAngle:u=0,id:l,highlightScope:h,highlighted:i,faded:j={additionalRadius:-5},data:m,arcLabel:x,arcLabelMinAngle:b=0,skipAnimation:v}=t,C=G(t,Xt),y=He({innerRadius:o,outerRadius:p,cornerRadius:c,paddingAngle:u,id:l,highlightScope:h,highlighted:i,faded:j,data:m}),w=Fe(y,F({},Ut,{immediate:v}));if(m.length===0)return null;const T=(a=r==null?void 0:r.pieArcLabel)!=null?a:qt;return s.jsx("g",F({},C,{children:w((R,k)=>{let{startAngle:I,endAngle:$,paddingAngle:M,innerRadius:B,outerRadius:S,cornerRadius:O}=R,J=G(R,Yt);return s.jsx(T,F({startAngle:I,endAngle:$,paddingAngle:M,innerRadius:B,outerRadius:S,cornerRadius:O,style:J,id:l,color:k.color,isFaded:k.isFaded,isHighlighted:k.isHighlighted,formattedArcLabel:Zt(x,b,k)},g==null?void 0:g.pieArcLabel))})}))}function ts(t){const{skipAnimation:a,slots:r,slotProps:g,onClick:o}=t,p=L.useContext(rt).pie,{left:c,top:u,width:l,height:h}=L.useContext(ot);if(p===void 0)return null;const i=Math.min(l,h)/2,j={x:c+l/2,y:u+h/2},{series:m,seriesOrder:x}=p;return s.jsxs("g",{children:[x.map(b=>{const{innerRadius:v,outerRadius:C,cornerRadius:y,paddingAngle:w,data:T,cx:R,cy:k,highlighted:I,faded:$,highlightScope:M}=m[b];return s.jsx("g",{transform:`translate(${R===void 0?j.x:c+R}, ${k===void 0?j.y:u+k})`,children:s.jsx(_t,{innerRadius:v,outerRadius:C??i,cornerRadius:y,paddingAngle:w,id:b,data:T,skipAnimation:a,highlightScope:M,highlighted:I,faded:$,onClick:o,slots:r,slotProps:g})},b)}),x.map(b=>{const{innerRadius:v,outerRadius:C,cornerRadius:y,paddingAngle:w,arcLabel:T,arcLabelMinAngle:R,data:k,cx:I,cy:$,highlightScope:M}=m[b];return s.jsx("g",{transform:`translate(${I===void 0?j.x:c+I}, ${$===void 0?j.y:u+$})`,children:s.jsx(es,{innerRadius:v,outerRadius:C??i,cornerRadius:y,paddingAngle:w,id:b,data:k,skipAnimation:a,arcLabel:T,arcLabelMinAngle:R,highlightScope:M})},b)})]})}const ss={top:5,bottom:5,left:5,right:100};function Le(t){const{xAxis:a,yAxis:r,series:g,width:o,height:p,margin:c,colors:u,sx:l,tooltip:h={trigger:"item"},axisHighlight:i={x:"none",y:"none"},skipAnimation:j,legend:m={direction:"column",position:{vertical:"middle",horizontal:"right"}},topAxis:x=null,leftAxis:b=null,rightAxis:v=null,bottomAxis:C=null,children:y,slots:w,slotProps:T,onClick:R}=t,k=F({},ss,c);return s.jsxs(dt,{series:g.map(I=>F({type:"pie"},I)),width:o,height:p,margin:k,xAxis:a??[{id:ct,scaleType:"point",data:[...new Array(Math.max(...g.map(I=>I.data.length)))].map((I,$)=>$)}],yAxis:r,colors:u,sx:l,disableAxisListener:(h==null?void 0:h.trigger)!=="axis"&&(i==null?void 0:i.x)==="none"&&(i==null?void 0:i.y)==="none",children:[s.jsx(ut,{topAxis:x,leftAxis:b,rightAxis:v,bottomAxis:C,slots:w,slotProps:T}),s.jsx(ts,{slots:w,slotProps:T,onClick:R,skipAnimation:j}),s.jsx(gt,F({},m,{slots:w,slotProps:T})),s.jsx(ht,F({},i)),s.jsx(pt,F({},h)),y]})}const ns=({chart:t,data:a,pie:r,windows:g})=>{const o=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#aec7e8","#ffbb78","#98df8a","#ff9896","#c5b0d5","#c49c94","#f7b6d2","#c7c7c7","#dbdb8d","#9edae5"],[p,c]=L.useState(window.innerWidth),u=()=>{c(window.innerWidth-32)};return window.addEventListener("resize",u),s.jsxs("div",{children:[s.jsx("h4",{children:"Failures count by platform"}),s.jsx(ye,{colors:o,xAxis:[{data:Object.entries(t).map(l=>l[0]),scaleType:"point"}],series:Object.entries(a).map(l=>({label:l[0],data:l[1].map(h=>h.count.single)})),width:p,height:500}),s.jsx("h4",{children:"Failures share by platform"}),s.jsx(me,{colors:o,xAxis:[{data:Object.entries(t).map(l=>l[0]),scaleType:"band"}],series:Object.entries(a).map(l=>({label:l[0],data:l[1].map(h=>h.share.single),stack:"total",stackOrder:"descending"})),width:p,height:500}),s.jsx("h4",{children:"Failures pie chart by platform (excluding multiplatform failures)"}),s.jsx(Le,{colors:o,series:[{arcLabel:l=>{const h=(l.endAngle-l.startAngle)/(2*Math.PI)*100;return`${l.label} ${h.toFixed(0)}%`},arcLabelMinAngle:20,data:Object.entries(r).filter(l=>l[0]!=="Multiplatform").map(l=>({label:l[0],value:l[1].single})),highlightScope:{faded:"global",highlighted:"item"},faded:{innerRadius:50,additionalRadius:-50,color:"gray"}}],width:p,height:900}),s.jsx("h4",{children:"Failures pie chart by platform (including multiplatform failures)"}),s.jsx(Le,{colors:o,series:[{arcLabel:l=>{const h=(l.endAngle-l.startAngle)/(2*Math.PI)*100;return`${l.label} ${h.toFixed(0)}%`},arcLabelMinAngle:20,data:Object.entries(r).filter(l=>l[0]!=="Multiplatform").map(l=>({label:l[0],value:l[1].multiple})),highlightScope:{faded:"global",highlighted:"item"},faded:{innerRadius:50,additionalRadius:-50,color:"gray"}}],width:p,height:900}),s.jsx("h4",{children:"Failures share for Windows"}),s.jsx(me,{xAxis:[{data:Object.entries(t).map(l=>l[0]),scaleType:"band"}],series:Object.entries(g).map(l=>({label:l[0]==="single"?"Windows only failures":l[0]==="multiple"?"Windows joined failures":"Other platform failures",data:l[1],stack:"total",color:l[0]==="single"?"red":l[0]==="multiple"?"yellow":"green"})),width:p,height:500})]})},is=({windows:t})=>{const a=Object.entries(t).reverse(),[r,g]=L.useState(window.innerWidth),o=()=>{g(window.innerWidth-32)};return window.addEventListener("resize",o),s.jsx("div",{children:s.jsx(me,{xAxis:[{data:a.map(p=>p[0]),scaleType:"band"}],series:[{data:a.length?a.map(p=>p[1].share):[0]}],width:r,height:500})})},as="node-test-commit",$e="node-test-commit-multiple",Me="node-test-commit-windows-fanned",ee={"node-test-commit":"No build","node-test-commit-multiple":"Multiplatform","node-test-linter":"Linter","node-test-commit-freebsd":"FreeBSD","node-test-commit-linux":"Linux","node-test-commit-osx":"macOS","node-test-commit-plinux":"Linux","node-test-commit-smartos":"SmartOS","node-test-commit-windows-fanned":"Windows","node-test-commit-linux-containered":"Linux","node-test-commit-arm":"ARM","node-test-commit-linuxone":"Linux","node-test-commit-aix":"AIX","node-test-commit-arm-fanned":"ARM","node-test-commit-custom-suites-freestyle":"Linux","node-test-commit-osx-arm":"macOS","node-test-commit-arm-debug":"ARM"},ds=()=>{const[t,a]=L.useState({tests:[],prs:[]}),[r,g]=L.useState(7),[o,p]=L.useState(!1),[c,u]=L.useState(!1),[l,h]=L.useState(10),[i,j]=L.useState("total"),[m,x]=L.useState(!1),[b,v]=L.useState({tests:[],prs:[]}),[C,y]=L.useState({table:[],chart:[]}),[w,T]=L.useState({prs:{},platforms:{chart:{},data:{},pie:{},windows:{}},windows:{}});L.useEffect(()=>{Ye().then(({data:S})=>{Ke(c).then(({data:O})=>{a({tests:S,prs:O})})})},[c]),L.useEffect(()=>{const S=(r==null?void 0:r.start)||Date.now()-r*24*60*60*1e3,O=(r==null?void 0:r.end)||Date.now(),J=t.tests.filter(e=>{var P;const n=e.timestamp>=S&&O>=e.timestamp,A=typeof((P=e==null?void 0:e.tap)==null?void 0:P.todo)=="string"&&e.tap.todo.includes("Fix flaky test");return n&&(o||!A)}),d=t.prs.filter(e=>{const n=new Date(e.date);return n>=S&&O>=n});v({tests:J,prs:d})},[t,r,o]),L.useEffect(()=>{const S={};for(const d of b.prs)S[d.prId]=d.id;const O=Object.entries(b.tests.reduce((d,e)=>{var n;return d[e.testName]||(d[e.testName]={total:0,flaky:0,builds:[],prs:[],data:[]}),++d[e.testName].total,typeof((n=e==null?void 0:e.tap)==null?void 0:n.todo)=="string"&&e.tap.todo.includes("Fix flaky test")&&++d[e.testName].flaky,d[e.testName].builds.includes(e.buildNumber)||d[e.testName].builds.push(e.buildNumber),e.callStack.length&&e.callStack[e.callStack.length-1].prId&&!d[e.testName].prs.includes(e.callStack[e.callStack.length-1].prId)&&d[e.testName].prs.push(e.callStack[e.callStack.length-1].prId),d[e.testName].data.push(e),d},{})).filter(d=>!m||d[1].prs.length>1).sort((d,e)=>{var N,P;const n=((N=d[1][i])==null?void 0:N.length)||d[1][i],A=((P=e[1][i])==null?void 0:P.length)||e[1][i];return n>A?-1:1}).slice(0,l),J=Object.entries(b.tests.reduce((d,e)=>{const n=new Date(e.timestamp).toLocaleDateString();return d[n]||(d[n]={tests:0,builds:[],prs:[]}),++d[n].tests,d[n].builds.includes(e.buildNumber)||d[n].builds.push(e.buildNumber),e.callStack.length&&e.callStack[e.callStack.length-1].prId&&!d[n].prs.includes(e.callStack[e.callStack.length-1].prId)&&d[n].prs.push(e.callStack[e.callStack.length-1].prId),d},{})).reverse();y({table:O,chart:J})},[l,i,m,b]),L.useEffect(()=>{const S=b.prs.filter(e=>{var P,W,D,V;const n=e.subBuilds.length&&typeof((W=(P=e.subBuilds[0])==null?void 0:P.build)==null?void 0:W.result)=="string",A=((V=(D=e.subBuilds[0])==null?void 0:D.build)==null?void 0:V.result)==="UNSTABLE";return n&&(c||!A)}).reverse(),O=S.reduce((e,n)=>{e[n.date]||(e[n.date]={builds:[],prs:[],platforms:{}}),e[n.date].builds.includes(n.id)||e[n.date].builds.push(n.id),e[n.date].prs.includes(n.prId)||e[n.date].prs.push(n.prId);const A=[...new Set(n.subBuilds[0].build.subBuilds.filter(N=>{const P=N.result==="FAILURE",W=N.result==="UNSTABLE";return P&&(c||!W)}).map(N=>ee[N.jobName]))];if(A.length===1)e[n.date].platforms[A[0]]||(e[n.date].platforms[A[0]]={builds:[],prs:[]}),e[n.date].platforms[A[0]].builds.includes(n.id)||e[n.date].platforms[A[0]].builds.push(n.id),e[n.date].platforms[A[0]].prs.includes(n.prId)||e[n.date].platforms[A[0]].prs.push(n.prId);else{const N=ee[A.length?$e:as];e[n.date].platforms[N]||(e[n.date].platforms[N]={builds:[],prs:[],platforms:{}}),e[n.date].platforms[N].builds.includes(n.id)||e[n.date].platforms[N].builds.push(n.id),e[n.date].platforms[N].prs.includes(n.prId)||e[n.date].platforms[N].prs.push(n.prId);for(const P of A)e[n.date].platforms[N].platforms[P]||(e[n.date].platforms[N].platforms[P]={builds:[],prs:[]}),e[n.date].platforms[N].platforms[P].builds.includes(n.id)||e[n.date].platforms[N].platforms[P].builds.push(n.id),e[n.date].platforms[N].platforms[P].prs.includes(n.prId)||e[n.date].platforms[N].platforms[P].prs.push(n.prId)}return e},{}),J=Object.entries(O).reduce((e,n,A)=>{var N,P,W;e.chart[n[0]]={total:n[1].builds.length};for(const D of Object.values(ee))e.chart[n[0]][D]={single:((N=n[1].platforms[D])==null?void 0:N.builds.length)||0,multiple:((W=(P=n[1].platforms[ee[$e]])==null?void 0:P.platforms[D])==null?void 0:W.builds.length)||0},e.data[D]||(e.data[D]=[]),e.data[D][A]||(e.data[D][A]={count:{single:0,multiple:0},share:{single:0,multiple:0}}),e.data[D][A].count.single=e.chart[n[0]][D].single,e.data[D][A].count.multiple=e.chart[n[0]][D].multiple,e.data[D][A].share.single=e.data[D][A].count.single/n[1].builds.length*100,e.data[D][A].share.multiple=e.data[D][A].count.multiple/n[1].builds.length*100,e.pie[D]||(e.pie[D]={single:0,multiple:0}),e.pie[D].single+=e.chart[n[0]][D].single,e.pie[D].multiple+=e.chart[n[0]][D].multiple,D===ee[Me]&&((!e.windows.single||!e.windows.multiple)&&(e.windows.single=[],e.windows.multiple=[],e.windows.none=[]),e.windows.single.push(e.data[D][e.data[D].length-1].share.single),e.windows.multiple.push(e.data[D][e.data[D].length-1].share.multiple),e.windows.none.push(100-(e.windows.single[e.windows.single.length-1]+e.windows.multiple[e.windows.multiple.length-1])));return e},{chart:{},data:{},pie:{},windows:{}}),d=Object.entries(S.filter(e=>e.subBuilds[0].build.subBuilds.length).map(e=>{for(const n of e.subBuilds[0].build.subBuilds)if(n.jobName===Me&&n.result==="FAILURE")return{buildNumber:n.buildNumber,phases:n.phases}}).filter(e=>e).reduce((e,n)=>{for(const A of n.phases)A.result==="FAILURE"&&(e[A.jobName]||(e[A.jobName]=[]),e[A.jobName].push(n.buildNumber),++e.total);return e},{total:0})).reduce((e,n,A,N)=>(n[0]!=="total"&&(e[n[0]]={count:n[1].length,share:n[1].length/N[0][1]*100,builds:n[1]}),e),{});T({prs:O,platforms:J,windows:d})},[c,b]);const R=S=>{g(typeof S.target.value=="string"?JSON.parse(S.target.value):S.target.value)},k=(S,O)=>{p(O)},I=(S,O)=>{u(O)},$=S=>{h(S.target.value)},M=S=>{j(S.target.value)},B=(S,O)=>{x(O)};return s.jsxs("div",{className:Ot,children:[s.jsx(X,{component:Ve,to:"/",children:"Back"}),s.jsx("h2",{children:"Dashboard"}),s.jsx("h4",{children:"Settings"}),s.jsxs(ce,{value:typeof r=="object"?JSON.stringify(r):r,onChange:R,children:[s.jsx(f,{value:1,children:"1 day"}),s.jsx(f,{value:7,children:"7 days"}),s.jsx(f,{value:15,children:"15 days"}),s.jsx(f,{value:30,children:"30 days"}),s.jsx(f,{value:90,children:"90 days"}),s.jsx(f,{value:180,children:"180 days"}),s.jsx(f,{value:365,children:"365 days"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,0).getTime(),end:new Date(2024,1).getTime()}),children:"January 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,1).getTime(),end:new Date(2024,2).getTime()}),children:"February 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,2).getTime(),end:new Date(2024,3).getTime()}),children:"March 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,3).getTime(),end:new Date(2024,4).getTime()}),children:"April 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,4).getTime(),end:new Date(2024,5).getTime()}),children:"May 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,5).getTime(),end:new Date(2024,6).getTime()}),children:"June 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,6).getTime(),end:new Date(2024,7).getTime()}),children:"July 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,7).getTime(),end:new Date(2024,8).getTime()}),children:"August 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,8).getTime(),end:new Date(2024,9).getTime()}),children:"September 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,9).getTime(),end:new Date(2024,10).getTime()}),children:"October 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,10).getTime(),end:new Date(2024,11).getTime()}),children:"November 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,11).getTime(),end:new Date(2025,0).getTime()}),children:"December 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,0).getTime(),end:new Date(2024,3).getTime()}),children:"Q1 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,3).getTime(),end:new Date(2024,6).getTime()}),children:"Q2 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,6).getTime(),end:new Date(2024,9).getTime()}),children:"Q3 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,9).getTime(),end:new Date(2025,0).getTime()}),children:"Q4 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,0).getTime(),end:new Date(2024,6).getTime()}),children:"H1 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,6).getTime(),end:new Date(2025,0).getTime()}),children:"H2 2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,0).getTime(),end:new Date(2025,0).getTime()}),children:"2024"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,0).getTime(),end:new Date(2025,1).getTime()}),children:"January 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,1).getTime(),end:new Date(2025,2).getTime()}),children:"February 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,2).getTime(),end:new Date(2025,3).getTime()}),children:"March 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,3).getTime(),end:new Date(2025,4).getTime()}),children:"April 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,4).getTime(),end:new Date(2025,5).getTime()}),children:"May 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,5).getTime(),end:new Date(2025,6).getTime()}),children:"June 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,6).getTime(),end:new Date(2025,7).getTime()}),children:"July 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,7).getTime(),end:new Date(2025,8).getTime()}),children:"August 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,8).getTime(),end:new Date(2025,9).getTime()}),children:"September 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,9).getTime(),end:new Date(2025,10).getTime()}),children:"October 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,10).getTime(),end:new Date(2025,11).getTime()}),children:"November 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,11).getTime(),end:new Date(2026,0).getTime()}),children:"December 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,0).getTime(),end:new Date(2025,3).getTime()}),children:"Q1 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,3).getTime(),end:new Date(2025,6).getTime()}),children:"Q2 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,6).getTime(),end:new Date(2025,9).getTime()}),children:"Q3 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,9).getTime(),end:new Date(2026,0).getTime()}),children:"Q4 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,0).getTime(),end:new Date(2025,6).getTime()}),children:"H1 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,6).getTime(),end:new Date(2026,0).getTime()}),children:"H2 2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2025,0).getTime(),end:new Date(2026,0).getTime()}),children:"2025"}),s.jsx(f,{value:JSON.stringify({start:new Date(2024,6).getTime(),end:new Date(2025,6).getTime()}),children:"FY 2025"})]}),"Duration",s.jsx(ue,{checked:o,onChange:k}),"Include flaky tests",s.jsx(ue,{checked:c,onChange:I}),"Include unstable builds",s.jsxs(ce,{value:l,onChange:$,children:[s.jsx(f,{value:10,children:"10"}),s.jsx(f,{value:20,children:"20"}),s.jsx(f,{value:50,children:"50"}),s.jsx(f,{value:100,children:"100"})]}),"Number of tests",s.jsxs(ce,{value:i,onChange:M,children:[s.jsx(f,{value:"total",children:"Failures"}),s.jsx(f,{value:"builds",children:"Builds"}),s.jsx(f,{value:"prs",children:"PRs"})]}),"Sort tests by",s.jsx(ue,{checked:m,onChange:B}),"Exclude tests from single PR",s.jsx("hr",{}),s.jsx("h2",{children:"Windows"}),s.jsx("h4",{children:"Most failed tests"}),s.jsx(It,{includeFlaky:o,table:C.table,prs:b.prs}),s.jsx("h4",{children:"CI failures chart (Windows)"}),s.jsx(Pt,{chart:C.chart}),s.jsx("hr",{}),s.jsx("h2",{children:"CI"}),s.jsx("h4",{children:"CI failures chart (All)"}),s.jsx(Lt,{chart:w.prs}),s.jsx(ns,{chart:w.platforms.chart,data:w.platforms.data,pie:w.platforms.pie,windows:w.platforms.windows}),s.jsx("h4",{children:"Windows job failures"}),s.jsx(is,{windows:w.windows})]})};export{ds as Dashboard};
