import{a as Y,b as me,s as be,i as We,h as Ee,_ as B,k as se,r as N,u as Je,c as q,l as _e,m as ze,j as s,d as ve,f as xe,B as Q,L as Ve}from"./index-_Xn7k0SU.js";import{L as Ae,P as we,T as Ge,a as qe,b as Xe,c as Ce,d as X,e as Qe,f as Ke,g as Ye,S as ce,C as ue}from"./api-J24q8VX7.js";import{w as Ze,h as Se,e as W,t as et,c as G,s as J,m as ge,a as ke,p as Ie,b as K,d as U,f as z,g as Te,i as tt,j as st,L as ye,k as Fe,u as nt,l as pe,I as at,n as it,o as lt,q as Be,S as ot,D as rt,R as dt,r as ct,C as ut,v as gt,x as ht,y as pt,B as fe}from"./BarChart-iDvepvPO.js";function ft(t){return t.innerRadius}function mt(t){return t.outerRadius}function bt(t){return t.startAngle}function xt(t){return t.endAngle}function yt(t){return t&&t.padAngle}function jt(t,i,o,g,r,p,c,u){var l=o-t,h=g-i,a=c-r,j=u-p,f=j*l-a*h;if(!(f*f<W))return f=(a*(i-p)-j*(t-r))/f,[t+f*l,i+f*h]}function ne(t,i,o,g,r,p,c){var u=t-o,l=i-g,h=(c?p:-p)/K(u*u+l*l),a=h*l,j=-h*u,f=t+a,b=i+j,m=o+a,R=g+j,k=(f+m)/2,x=(b+R)/2,y=m-f,w=R-b,v=y*y+w*w,I=r-p,D=f*R-m*b,O=(w<0?-1:1)*K(st(0,I*I*v-D*D)),M=(D*w-y*O)/v,H=(-D*y-w*O)/v,C=(D*w+y*O)/v,P=(-D*y+w*O)/v,F=M-k,d=H-x,e=C-k,n=P-x;return F*F+d*d>e*e+n*n&&(M=C,H=P),{cx:M,cy:H,x01:-a,y01:-j,x11:M*(r/I-1),y11:H*(r/I-1)}}function He(){var t=ft,i=mt,o=z(0),g=null,r=bt,p=xt,c=yt,u=null,l=Ze(h);function h(){var a,j,f=+t.apply(this,arguments),b=+i.apply(this,arguments),m=r.apply(this,arguments)-Se,R=p.apply(this,arguments)-Se,k=ke(R-m),x=R>m;if(u||(u=a=l()),b<f&&(j=b,b=f,f=j),!(b>W))u.moveTo(0,0);else if(k>et-W)u.moveTo(b*G(m),b*J(m)),u.arc(0,0,b,m,R,!x),f>W&&(u.moveTo(f*G(R),f*J(R)),u.arc(0,0,f,R,m,x));else{var y=m,w=R,v=m,I=R,D=k,O=k,M=c.apply(this,arguments)/2,H=M>W&&(g?+g.apply(this,arguments):K(f*f+b*b)),C=ge(ke(b-f)/2,+o.apply(this,arguments)),P=C,F=C,d,e;if(H>W){var n=Te(H/f*J(M)),A=Te(H/b*J(M));(D-=n*2)>W?(n*=x?1:-1,v+=n,I-=n):(D=0,v=I=(m+R)/2),(O-=A*2)>W?(A*=x?1:-1,y+=A,w-=A):(O=0,y=w=(m+R)/2)}var T=b*G(y),L=b*J(y),E=f*G(I),S=f*J(I);if(C>W){var V=b*G(w),te=b*J(w),ae=f*G(v),ie=f*J(v),_;if(k<Ie)if(_=jt(T,L,ae,ie,V,te,E,S)){var le=T-_[0],oe=L-_[1],re=V-_[0],de=te-_[1],je=1/J(tt((le*re+oe*de)/(K(le*le+oe*oe)*K(re*re+de*de)))/2),Re=K(_[0]*_[0]+_[1]*_[1]);P=ge(C,(f-Re)/(je-1)),F=ge(C,(b-Re)/(je+1))}else P=F=0}O>W?F>W?(d=ne(ae,ie,T,L,b,F,x),e=ne(V,te,E,S,b,F,x),u.moveTo(d.cx+d.x01,d.cy+d.y01),F<C?u.arc(d.cx,d.cy,F,U(d.y01,d.x01),U(e.y01,e.x01),!x):(u.arc(d.cx,d.cy,F,U(d.y01,d.x01),U(d.y11,d.x11),!x),u.arc(0,0,b,U(d.cy+d.y11,d.cx+d.x11),U(e.cy+e.y11,e.cx+e.x11),!x),u.arc(e.cx,e.cy,F,U(e.y11,e.x11),U(e.y01,e.x01),!x))):(u.moveTo(T,L),u.arc(0,0,b,y,w,!x)):u.moveTo(T,L),!(f>W)||!(D>W)?u.lineTo(E,S):P>W?(d=ne(E,S,V,te,f,-P,x),e=ne(T,L,ae,ie,f,-P,x),u.lineTo(d.cx+d.x01,d.cy+d.y01),P<C?u.arc(d.cx,d.cy,P,U(d.y01,d.x01),U(e.y01,e.x01),!x):(u.arc(d.cx,d.cy,P,U(d.y01,d.x01),U(d.y11,d.x11),!x),u.arc(0,0,f,U(d.cy+d.y11,d.cx+d.x11),U(e.cy+e.y11,e.cx+e.x11),x),u.arc(e.cx,e.cy,P,U(e.y11,e.x11),U(e.y01,e.x01),!x))):u.arc(0,0,f,I,v,x)}if(u.closePath(),a)return u=null,a+""||null}return h.centroid=function(){var a=(+t.apply(this,arguments)+ +i.apply(this,arguments))/2,j=(+r.apply(this,arguments)+ +p.apply(this,arguments))/2-Ie/2;return[G(j)*a,J(j)*a]},h.innerRadius=function(a){return arguments.length?(t=typeof a=="function"?a:z(+a),h):t},h.outerRadius=function(a){return arguments.length?(i=typeof a=="function"?a:z(+a),h):i},h.cornerRadius=function(a){return arguments.length?(o=typeof a=="function"?a:z(+a),h):o},h.padRadius=function(a){return arguments.length?(g=a==null?null:typeof a=="function"?a:z(+a),h):g},h.startAngle=function(a){return arguments.length?(r=typeof a=="function"?a:z(+a),h):r},h.endAngle=function(a){return arguments.length?(p=typeof a=="function"?a:z(+a),h):p},h.padAngle=function(a){return arguments.length?(c=typeof a=="function"?a:z(+a),h):c},h.context=function(a){return arguments.length?(u=a??null,h):u},h}const Rt=Y("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]),Pe=Rt,vt=Y("MuiListItemIcon",["root","alignItemsFlexStart"]),De=vt,At=Y("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]),Le=At;function wt(t){return me("MuiMenuItem",t)}const Ct=Y("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),Z=Ct,St=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],kt=(t,i)=>{const{ownerState:o}=t;return[i.root,o.dense&&i.dense,o.divider&&i.divider,!o.disableGutters&&i.gutters]},It=t=>{const{disabled:i,dense:o,divider:g,disableGutters:r,selected:p,classes:c}=t,l=xe({root:["root",o&&"dense",i&&"disabled",!r&&"gutters",g&&"divider",p&&"selected"]},wt,c);return B({},c,l)},Tt=be(We,{shouldForwardProp:t=>Ee(t)||t==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:kt})(({theme:t,ownerState:i})=>B({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!i.disableGutters&&{paddingLeft:16,paddingRight:16},i.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Z.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:se(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${Z.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:se(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${Z.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:se(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:se(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${Z.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${Z.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${Pe.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${Pe.inset}`]:{marginLeft:52},[`& .${Le.root}`]:{marginTop:0,marginBottom:0},[`& .${Le.inset}`]:{paddingLeft:36},[`& .${De.root}`]:{minWidth:36}},!i.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},i.dense&&B({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${De.root} svg`]:{fontSize:"1.25rem"}}))),Pt=N.forwardRef(function(i,o){const g=Je({props:i,name:"MuiMenuItem"}),{autoFocus:r=!1,component:p="li",dense:c=!1,divider:u=!1,disableGutters:l=!1,focusVisibleClassName:h,role:a="menuitem",tabIndex:j,className:f}=g,b=q(g,St),m=N.useContext(Ae),R=N.useMemo(()=>({dense:c||m.dense||!1,disableGutters:l}),[m.dense,c,l]),k=N.useRef(null);_e(()=>{r&&k.current&&k.current.focus()},[r]);const x=B({},g,{dense:R.dense,divider:u,disableGutters:l}),y=It(g),w=ze(k,o);let v;return g.disabled||(v=j!==void 0?j:-1),s.jsx(Ae.Provider,{value:R,children:s.jsx(Tt,B({ref:w,role:a,tabIndex:v,component:p,focusVisibleClassName:ve(y.focusVisible,h),className:ve(y.root,f)},b,{ownerState:x,classes:y}))})}),$=Pt,he="_tableHeaderCell_tnbpf_1",Dt="_container_tnbpf_9";const Lt=({includeFlaky:t,table:i,prs:o})=>{const g=c=>{const u={};for(const l of c){const h=new Date(l.timestamp).toLocaleDateString();u[h]||(u[h]=0),++u[h]}return u},r=c=>{{const l=`https://ci.nodejs.org/job/${c.length&&c[0].buildUrl.includes("job/node-test-binary-windows-js-suites")?"node-test-binary-windows-js-suites":"node-test-binary-windows-native-suites"}/`,h=[...new Set(c.map(j=>`${l}${j.buildNumber}`))],a=c.map(j=>j.buildUrl);return{builds:h,urls:a}}},p=c=>{{const u={};for(const a of o)u[a.prId]=a.id;const l=[];for(const a of c)a.callStack.length&&a.callStack[a.callStack.length-1].prId&&!l.includes(+a.callStack[a.callStack.length-1].prId)&&l.push(+a.callStack[a.callStack.length-1].prId);const h=l.map(a=>`https://github.com/nodejs/node/pull/${a}`);return{prs:l,urls:h}}};return s.jsx(we,{children:s.jsx(Ge,{component:we,children:s.jsxs(qe,{stickyHeader:!0,size:"small","aria-label":"a dense table",children:[s.jsx(Xe,{children:s.jsxs(Ce,{children:[s.jsx(X,{className:he,children:"Name"}),s.jsxs(X,{className:he,children:["Failures",t?"(flaky)":""," / Builds / PRs"]}),s.jsx(X,{className:he,children:"Actions"})]})}),s.jsx(Qe,{children:i.map((c,u)=>s.jsxs(Ce,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[s.jsx(X,{component:"th",scope:"row",children:c[0]}),s.jsxs(X,{children:[c[1].total,c[1].flaky?s.jsxs("span",{children:["(",c[1].flaky,")"]}):null," / ",c[1].builds.length," / ",c[1].prs.length]}),s.jsxs(X,{children:[s.jsx(Q,{onClick:()=>{window.open(`https://github.com/nodejs/reliability/issues?q=is%3Aissue+is%3Aopen+${encodeURI(c[0])}`)},children:"Reliability"}),s.jsx(Q,{onClick:()=>{console.clear(),console.log(c[0]),console.log(c[1].data)},children:"Data"}),s.jsx(Q,{onClick:()=>{console.clear(),console.log(c[0]),console.log(g(c[1].data))},children:"Chart"}),s.jsx(Q,{onClick:()=>{console.clear(),console.log(c[0]),console.log(r(c[1].data))},onDoubleClick:()=>{for(const l of r(c[1].data).builds)window.open(l)},children:"Builds"}),s.jsx(Q,{onClick:()=>{console.clear(),console.log(c[0]),console.log(p(c[1].data))},onDoubleClick:()=>{for(const l of p(c[1].data).urls)window.open(l)},children:"PRs"})]})]},u))})]})})})},Nt=({chart:t})=>{const[i,o]=N.useState(window.innerWidth),g=()=>{o(window.innerWidth-32)};return window.addEventListener("resize",g),s.jsx("div",{children:s.jsx(ye,{xAxis:[{data:t.map(r=>r[0]),scaleType:"point"}],series:[{label:"Tests",data:t.map(r=>r[1].tests)},{label:"Builds",data:t.map(r=>r[1].builds.length)},{label:"PRs",data:t.map(r=>r[1].prs.length)}],width:i,height:500})})},Ot=({chart:t})=>{const[i,o]=N.useState(window.innerWidth),g=()=>{o(window.innerWidth-32)};return window.addEventListener("resize",g),s.jsx("div",{children:s.jsx(ye,{xAxis:[{data:Object.entries(t).map(r=>r[0]),scaleType:"point"}],series:[{label:"Builds",data:Object.entries(t).map(r=>r[1].builds.length)},{label:"PRs",data:Object.entries(t).map(r=>r[1].prs.length)}],width:i,height:500})})},$t=["id","dataIndex","classes","color","highlightScope","onClick","isFaded","isHighlighted","startAngle","endAngle","paddingAngle","innerRadius","outerRadius","cornerRadius"];function Mt(t){return me("MuiPieArc",t)}Y("MuiPieArc",["root","highlighted","faded"]);const Ft=t=>{const{classes:i,id:o,isFaded:g,isHighlighted:r}=t,p={root:["root",`series-${o}`,r&&"highlighted",g&&"faded"]};return xe(p,Mt,i)},Bt=be(Fe.path,{name:"MuiPieArc",slot:"Root",overridesResolver:(t,i)=>i.arc})(({theme:t})=>({stroke:(t.vars||t).palette.background.paper,strokeWidth:1,strokeLinejoin:"round"}));function Ht(t){const{id:i,dataIndex:o,classes:g,color:r,highlightScope:p,onClick:c,isFaded:u,isHighlighted:l,startAngle:h,endAngle:a,paddingAngle:j,innerRadius:f,outerRadius:b,cornerRadius:m}=t,R=q(t,$t),k={id:i,dataIndex:o,classes:g,color:r,isFaded:u,isHighlighted:l},x=Ft(k),y=nt(p);return s.jsx(Bt,B({d:pe([h,a,j,f,b,m],(w,v,I,D,O,M)=>He().cornerRadius(M)({padAngle:I,startAngle:w,endAngle:v,innerRadius:D,outerRadius:O})),onClick:c,cursor:c?"pointer":"unset",ownerState:k,className:x.root},R,y({type:"pie",seriesId:i,dataIndex:o})))}const Ut={keys:t=>t.id,from:({innerRadius:t,outerRadius:i,cornerRadius:o,startAngle:g,endAngle:r,paddingAngle:p,color:c,isFaded:u})=>({innerRadius:t,outerRadius:(t+i)/2,cornerRadius:o,startAngle:(g+r)/2,endAngle:(g+r)/2,paddingAngle:p,fill:c,opacity:u?.3:1}),leave:({innerRadius:t,startAngle:i,endAngle:o})=>({innerRadius:t,outerRadius:t,startAngle:(i+o)/2,endAngle:(i+o)/2}),enter:({innerRadius:t,outerRadius:i,startAngle:o,endAngle:g})=>({innerRadius:t,outerRadius:i,startAngle:o,endAngle:g}),update:({innerRadius:t,outerRadius:i,cornerRadius:o,startAngle:g,endAngle:r,paddingAngle:p,color:c,isFaded:u})=>({innerRadius:t,outerRadius:i,cornerRadius:o,startAngle:g,endAngle:r,paddingAngle:p,fill:c,opacity:u?.3:1}),config:{tension:120,friction:14,clamp:!0}},Wt={keys:t=>t.id,from:({innerRadius:t,outerRadius:i,cornerRadius:o,startAngle:g,endAngle:r,paddingAngle:p})=>({innerRadius:t,outerRadius:(t+i)/2,cornerRadius:o,startAngle:(g+r)/2,endAngle:(g+r)/2,paddingAngle:p,opacity:0}),leave:({innerRadius:t,startAngle:i,endAngle:o})=>({innerRadius:t,outerRadius:t,startAngle:(i+o)/2,endAngle:(i+o)/2,opacity:0}),enter:({innerRadius:t,outerRadius:i,startAngle:o,endAngle:g})=>({innerRadius:t,outerRadius:i,startAngle:o,endAngle:g,opacity:1}),update:({innerRadius:t,outerRadius:i,cornerRadius:o,startAngle:g,endAngle:r,paddingAngle:p})=>({innerRadius:t,outerRadius:i,cornerRadius:o,startAngle:g,endAngle:r,paddingAngle:p,opacity:1}),config:{tension:120,friction:14,clamp:!0}};function Ue(t){const{id:i,highlightScope:o,data:g,faded:r,highlighted:p,paddingAngle:c=0,innerRadius:u=0,outerRadius:l,cornerRadius:h=0}=t,{item:a}=N.useContext(at),j=N.useCallback(b=>{const m=it(a,{type:"pie",seriesId:i,dataIndex:b},o),R=!m&&lt(a,{type:"pie",seriesId:i,dataIndex:b},o);return{isHighlighted:m,isFaded:R}},[o,a,i]);return N.useMemo(()=>g.map((b,m)=>{var R,k,x,y;const{isHighlighted:w,isFaded:v}=j(m),I=B({additionalRadius:0},v&&r||w&&p||{}),D=Math.max(0,Math.PI*((R=I.paddingAngle)!=null?R:c)/180),O=Math.max(0,(k=I.innerRadius)!=null?k:u),M=Math.max(0,(x=I.outerRadius)!=null?x:l+I.additionalRadius),H=(y=I.cornerRadius)!=null?y:h;return B({},b,I,{isFaded:v,isHighlighted:w,paddingAngle:D,innerRadius:O,outerRadius:M,cornerRadius:H})}),[h,u,l,c,g,r,j,p])}const Et=["slots","slotProps","innerRadius","outerRadius","cornerRadius","paddingAngle","id","highlightScope","highlighted","faded","data","onClick","skipAnimation"],Jt=["startAngle","endAngle","paddingAngle","innerRadius","outerRadius","cornerRadius"];function _t(t){var i;const{slots:o,slotProps:g,innerRadius:r=0,outerRadius:p,cornerRadius:c=0,paddingAngle:u=0,id:l,highlightScope:h,highlighted:a,faded:j={additionalRadius:-5},data:f,onClick:b,skipAnimation:m}=t,R=q(t,Et),k=Ue({innerRadius:r,outerRadius:p,cornerRadius:c,paddingAngle:u,id:l,highlightScope:h,highlighted:a,faded:j,data:f}),x=Be(k,B({},Ut,{immediate:m}));if(f.length===0)return null;const y=(i=o==null?void 0:o.pieArc)!=null?i:Ht;return s.jsx("g",B({},R,{children:x((w,v,I,D)=>{let{startAngle:O,endAngle:M,paddingAngle:H,innerRadius:C,outerRadius:P,cornerRadius:F}=w,d=q(w,Jt);return s.jsx(y,B({startAngle:O,endAngle:M,paddingAngle:H,innerRadius:C,outerRadius:P,cornerRadius:F,style:d,id:l,color:v.color,dataIndex:D,highlightScope:h,isFaded:v.isFaded,isHighlighted:v.isHighlighted,onClick:b&&(e=>{b(e,{type:"pie",seriesId:l,dataIndex:D},v)})},g==null?void 0:g.pieArc))})}))}const zt=["id","classes","color","startAngle","endAngle","paddingAngle","innerRadius","outerRadius","cornerRadius","formattedArcLabel","isHighlighted","isFaded","style"];function Vt(t){return me("MuiPieArcLabel",t)}Y("MuiPieArcLabel",["root","highlighted","faded"]);const Gt=t=>{const{classes:i,id:o,isFaded:g,isHighlighted:r}=t,p={root:["root",`series-${o}`,r&&"highlighted",g&&"faded"]};return xe(p,Vt,i)},qt=be(Fe.text,{name:"MuiPieArcLabel",slot:"Root",overridesResolver:(t,i)=>i.root})(({theme:t})=>({fill:(t.vars||t).palette.text.primary,textAnchor:"middle",dominantBaseline:"middle"})),Ne=(t,i)=>(o,g,r,p,c,u)=>{if(!t)return 0;const[l,h]=He().cornerRadius(u).centroid({padAngle:r,startAngle:o,endAngle:g,innerRadius:p,outerRadius:c});return i==="x"?l:h};function Xt(t){const{id:i,classes:o,color:g,startAngle:r,endAngle:p,paddingAngle:c,innerRadius:u,outerRadius:l,cornerRadius:h,formattedArcLabel:a,isHighlighted:j,isFaded:f,style:b}=t,m=q(t,zt),k=Gt({id:i,classes:o,color:g,isFaded:f,isHighlighted:j});return s.jsx(qt,B({className:k.root},m,{style:B({x:pe([r,p,c,u,l,h],Ne(a,"x")),y:pe([r,p,c,u,l,h],Ne(a,"y"))},b),children:a}))}const Qt=["slots","slotProps","innerRadius","outerRadius","cornerRadius","paddingAngle","id","highlightScope","highlighted","faded","data","arcLabel","arcLabelMinAngle","skipAnimation"],Kt=["startAngle","endAngle","paddingAngle","innerRadius","outerRadius","cornerRadius"],Yt=180/Math.PI;function Zt(t,i,o){if(!t||(o.endAngle-o.startAngle)*Yt<i)return null;if(typeof t=="string"){var r;return(r=o[t])==null?void 0:r.toString()}return t(o)}function es(t){var i;const{slots:o,slotProps:g,innerRadius:r=0,outerRadius:p,cornerRadius:c=0,paddingAngle:u=0,id:l,highlightScope:h,highlighted:a,faded:j={additionalRadius:-5},data:f,arcLabel:b,arcLabelMinAngle:m=0,skipAnimation:R}=t,k=q(t,Qt),x=Ue({innerRadius:r,outerRadius:p,cornerRadius:c,paddingAngle:u,id:l,highlightScope:h,highlighted:a,faded:j,data:f}),y=Be(x,B({},Wt,{immediate:R}));if(f.length===0)return null;const w=(i=o==null?void 0:o.pieArcLabel)!=null?i:Xt;return s.jsx("g",B({},k,{children:y((v,I)=>{let{startAngle:D,endAngle:O,paddingAngle:M,innerRadius:H,outerRadius:C,cornerRadius:P}=v,F=q(v,Kt);return s.jsx(w,B({startAngle:D,endAngle:O,paddingAngle:M,innerRadius:H,outerRadius:C,cornerRadius:P,style:F,id:l,color:I.color,isFaded:I.isFaded,isHighlighted:I.isHighlighted,formattedArcLabel:Zt(b,m,I)},g==null?void 0:g.pieArcLabel))})}))}function ts(t){const{skipAnimation:i,slots:o,slotProps:g,onClick:r}=t,p=N.useContext(ot).pie,{left:c,top:u,width:l,height:h}=N.useContext(rt);if(p===void 0)return null;const a=Math.min(l,h)/2,j={x:c+l/2,y:u+h/2},{series:f,seriesOrder:b}=p;return s.jsxs("g",{children:[b.map(m=>{const{innerRadius:R,outerRadius:k,cornerRadius:x,paddingAngle:y,data:w,cx:v,cy:I,highlighted:D,faded:O,highlightScope:M}=f[m];return s.jsx("g",{transform:`translate(${v===void 0?j.x:c+v}, ${I===void 0?j.y:u+I})`,children:s.jsx(_t,{innerRadius:R,outerRadius:k??a,cornerRadius:x,paddingAngle:y,id:m,data:w,skipAnimation:i,highlightScope:M,highlighted:D,faded:O,onClick:r,slots:o,slotProps:g})},m)}),b.map(m=>{const{innerRadius:R,outerRadius:k,cornerRadius:x,paddingAngle:y,arcLabel:w,arcLabelMinAngle:v,data:I,cx:D,cy:O,highlightScope:M}=f[m];return s.jsx("g",{transform:`translate(${D===void 0?j.x:c+D}, ${O===void 0?j.y:u+O})`,children:s.jsx(es,{innerRadius:R,outerRadius:k??a,cornerRadius:x,paddingAngle:y,id:m,data:I,skipAnimation:i,arcLabel:w,arcLabelMinAngle:v,highlightScope:M})},m)})]})}const ss={top:5,bottom:5,left:5,right:100};function Oe(t){const{xAxis:i,yAxis:o,series:g,width:r,height:p,margin:c,colors:u,sx:l,tooltip:h={trigger:"item"},axisHighlight:a={x:"none",y:"none"},skipAnimation:j,legend:f={direction:"column",position:{vertical:"middle",horizontal:"right"}},topAxis:b=null,leftAxis:m=null,rightAxis:R=null,bottomAxis:k=null,children:x,slots:y,slotProps:w,onClick:v}=t,I=B({},ss,c);return s.jsxs(dt,{series:g.map(D=>B({type:"pie"},D)),width:r,height:p,margin:I,xAxis:i??[{id:ct,scaleType:"point",data:[...new Array(Math.max(...g.map(D=>D.data.length)))].map((D,O)=>O)}],yAxis:o,colors:u,sx:l,disableAxisListener:(h==null?void 0:h.trigger)!=="axis"&&(a==null?void 0:a.x)==="none"&&(a==null?void 0:a.y)==="none",children:[s.jsx(ut,{topAxis:b,leftAxis:m,rightAxis:R,bottomAxis:k,slots:y,slotProps:w}),s.jsx(ts,{slots:y,slotProps:w,onClick:v,skipAnimation:j}),s.jsx(gt,B({},f,{slots:y,slotProps:w})),s.jsx(ht,B({},a)),s.jsx(pt,B({},h)),x]})}const ns=({chart:t,data:i,pie:o,windows:g})=>{const r=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#aec7e8","#ffbb78","#98df8a","#ff9896","#c5b0d5","#c49c94","#f7b6d2","#c7c7c7","#dbdb8d","#9edae5"],[p,c]=N.useState(window.innerWidth),u=()=>{c(window.innerWidth-32)};return window.addEventListener("resize",u),s.jsxs("div",{children:[s.jsx("h4",{children:"Failures count by platform"}),s.jsx(ye,{colors:r,xAxis:[{data:Object.entries(t).map(l=>l[0]),scaleType:"point"}],series:Object.entries(i).map(l=>({label:l[0],data:l[1].map(h=>h.count.single)})),width:p,height:500}),s.jsx("h4",{children:"Failures share by platform"}),s.jsx(fe,{colors:r,xAxis:[{data:Object.entries(t).map(l=>l[0]),scaleType:"band"}],series:Object.entries(i).map(l=>({label:l[0],data:l[1].map(h=>h.share.single),stack:"total",stackOrder:"descending"})),width:p,height:500}),s.jsx("h4",{children:"Failures pie chart by platform (excluding multiplatform failures)"}),s.jsx(Oe,{colors:r,series:[{arcLabel:l=>{const h=(l.endAngle-l.startAngle)/(2*Math.PI)*100;return`${l.label} ${h.toFixed(0)}%`},arcLabelMinAngle:20,data:Object.entries(o).filter(l=>l[0]!=="Multiplatform").map(l=>({label:l[0],value:l[1].single})),highlightScope:{faded:"global",highlighted:"item"},faded:{innerRadius:50,additionalRadius:-50,color:"gray"}}],width:p,height:900}),s.jsx("h4",{children:"Failures pie chart by platform (including multiplatform failures)"}),s.jsx(Oe,{colors:r,series:[{arcLabel:l=>{const h=(l.endAngle-l.startAngle)/(2*Math.PI)*100;return`${l.label} ${h.toFixed(0)}%`},arcLabelMinAngle:20,data:Object.entries(o).filter(l=>l[0]!=="Multiplatform").map(l=>({label:l[0],value:l[1].multiple})),highlightScope:{faded:"global",highlighted:"item"},faded:{innerRadius:50,additionalRadius:-50,color:"gray"}}],width:p,height:900}),s.jsx("h4",{children:"Failures share for Windows"}),s.jsx(fe,{xAxis:[{data:Object.entries(t).map(l=>l[0]),scaleType:"band"}],series:Object.entries(g).map(l=>({label:l[0]==="single"?"Windows only failures":l[0]==="multiple"?"Windows joined failures":"Other platform failures",data:l[1],stack:"total",color:l[0]==="single"?"red":l[0]==="multiple"?"yellow":"green"})),width:p,height:500})]})},as=({windows:t})=>{const i=Object.entries(t).reverse(),[o,g]=N.useState(window.innerWidth),r=()=>{g(window.innerWidth-32)};return window.addEventListener("resize",r),s.jsx("div",{children:s.jsx(fe,{xAxis:[{data:i.map(p=>p[0]),scaleType:"band"}],series:[{data:i.length?i.map(p=>p[1].share):[0]}],width:o,height:500})})},is="node-test-commit",$e="node-test-commit-multiple",Me="node-test-commit-windows-fanned",ee={"node-test-commit":"No build","node-test-commit-multiple":"Multiplatform","node-test-linter":"Linter","node-test-commit-freebsd":"FreeBSD","node-test-commit-linux":"Linux","node-test-commit-osx":"macOS","node-test-commit-plinux":"Linux","node-test-commit-smartos":"SmartOS","node-test-commit-windows-fanned":"Windows","node-test-commit-linux-containered":"Linux","node-test-commit-arm":"ARM","node-test-commit-linuxone":"Linux","node-test-commit-aix":"AIX","node-test-commit-arm-fanned":"ARM","node-test-commit-custom-suites-freestyle":"Linux","node-test-commit-osx-arm":"macOS","node-test-commit-arm-debug":"ARM"},ds=()=>{const[t,i]=N.useState({tests:[],prs:[]}),[o,g]=N.useState(7),[r,p]=N.useState(!1),[c,u]=N.useState(!1),[l,h]=N.useState(10),[a,j]=N.useState("total"),[f,b]=N.useState(!1),[m,R]=N.useState({tests:[],prs:[]}),[k,x]=N.useState({table:[],chart:[]}),[y,w]=N.useState({prs:{},platforms:{chart:{},data:{},pie:{},windows:{}},windows:{}});N.useEffect(()=>{Ke().then(({data:C})=>{Ye(c).then(({data:P})=>{i({tests:C,prs:P})})})},[c]),N.useEffect(()=>{const C=(o==null?void 0:o.start)||Date.now()-o*24*60*60*1e3,P=(o==null?void 0:o.end)||Date.now(),F=t.tests.filter(e=>{var L;const n=e.timestamp>=C&&P>=e.timestamp,A=typeof((L=e==null?void 0:e.tap)==null?void 0:L.todo)=="string"&&e.tap.todo.includes("Fix flaky test");return n&&(r||!A)}),d=t.prs.filter(e=>{const n=new Date(e.date);return n>=C&&P>=n});R({tests:F,prs:d})},[t,o,r]),N.useEffect(()=>{const C={};for(const d of m.prs)C[d.prId]=d.id;const P=Object.entries(m.tests.reduce((d,e)=>{var n;return d[e.testName]||(d[e.testName]={total:0,flaky:0,builds:[],prs:[],data:[]}),++d[e.testName].total,typeof((n=e==null?void 0:e.tap)==null?void 0:n.todo)=="string"&&e.tap.todo.includes("Fix flaky test")&&++d[e.testName].flaky,d[e.testName].builds.includes(e.buildNumber)||d[e.testName].builds.push(e.buildNumber),e.callStack.length&&e.callStack[e.callStack.length-1].prId&&!d[e.testName].prs.includes(e.callStack[e.callStack.length-1].prId)&&d[e.testName].prs.push(e.callStack[e.callStack.length-1].prId),d[e.testName].data.push(e),d},{})).filter(d=>!f||d[1].prs.length>1).sort((d,e)=>{var T,L;const n=((T=d[1][a])==null?void 0:T.length)||d[1][a],A=((L=e[1][a])==null?void 0:L.length)||e[1][a];return n>A?-1:1}).slice(0,l),F=Object.entries(m.tests.reduce((d,e)=>{const n=new Date(e.timestamp).toLocaleDateString();return d[n]||(d[n]={tests:0,builds:[],prs:[]}),++d[n].tests,d[n].builds.includes(e.buildNumber)||d[n].builds.push(e.buildNumber),e.callStack.length&&e.callStack[e.callStack.length-1].prId&&!d[n].prs.includes(e.callStack[e.callStack.length-1].prId)&&d[n].prs.push(e.callStack[e.callStack.length-1].prId),d},{})).reverse();x({table:P,chart:F})},[l,a,f,m]),N.useEffect(()=>{const C=m.prs.filter(e=>{var L,E,S,V;const n=e.subBuilds.length&&typeof((E=(L=e.subBuilds[0])==null?void 0:L.build)==null?void 0:E.result)=="string",A=((V=(S=e.subBuilds[0])==null?void 0:S.build)==null?void 0:V.result)==="UNSTABLE";return n&&(c||!A)}).reverse(),P=C.reduce((e,n)=>{e[n.date]||(e[n.date]={builds:[],prs:[],platforms:{}}),e[n.date].builds.includes(n.id)||e[n.date].builds.push(n.id),e[n.date].prs.includes(n.prId)||e[n.date].prs.push(n.prId);const A=[...new Set(n.subBuilds[0].build.subBuilds.filter(T=>{const L=T.result==="FAILURE",E=T.result==="UNSTABLE";return L&&(c||!E)}).map(T=>ee[T.jobName]))];if(A.length===1)e[n.date].platforms[A[0]]||(e[n.date].platforms[A[0]]={builds:[],prs:[]}),e[n.date].platforms[A[0]].builds.includes(n.id)||e[n.date].platforms[A[0]].builds.push(n.id),e[n.date].platforms[A[0]].prs.includes(n.prId)||e[n.date].platforms[A[0]].prs.push(n.prId);else{const T=ee[A.length?$e:is];e[n.date].platforms[T]||(e[n.date].platforms[T]={builds:[],prs:[],platforms:{}}),e[n.date].platforms[T].builds.includes(n.id)||e[n.date].platforms[T].builds.push(n.id),e[n.date].platforms[T].prs.includes(n.prId)||e[n.date].platforms[T].prs.push(n.prId);for(const L of A)e[n.date].platforms[T].platforms[L]||(e[n.date].platforms[T].platforms[L]={builds:[],prs:[]}),e[n.date].platforms[T].platforms[L].builds.includes(n.id)||e[n.date].platforms[T].platforms[L].builds.push(n.id),e[n.date].platforms[T].platforms[L].prs.includes(n.prId)||e[n.date].platforms[T].platforms[L].prs.push(n.prId)}return e},{}),F=Object.entries(P).reduce((e,n,A)=>{var T,L,E;e.chart[n[0]]={total:n[1].builds.length};for(const S of Object.values(ee))e.chart[n[0]][S]={single:((T=n[1].platforms[S])==null?void 0:T.builds.length)||0,multiple:((E=(L=n[1].platforms[ee[$e]])==null?void 0:L.platforms[S])==null?void 0:E.builds.length)||0},e.data[S]||(e.data[S]=[]),e.data[S][A]||(e.data[S][A]={count:{single:0,multiple:0},share:{single:0,multiple:0}}),e.data[S][A].count.single=e.chart[n[0]][S].single,e.data[S][A].count.multiple=e.chart[n[0]][S].multiple,e.data[S][A].share.single=e.data[S][A].count.single/n[1].builds.length*100,e.data[S][A].share.multiple=e.data[S][A].count.multiple/n[1].builds.length*100,e.pie[S]||(e.pie[S]={single:0,multiple:0}),e.pie[S].single+=e.chart[n[0]][S].single,e.pie[S].multiple+=e.chart[n[0]][S].multiple,S===ee[Me]&&((!e.windows.single||!e.windows.multiple)&&(e.windows.single=[],e.windows.multiple=[],e.windows.none=[]),e.windows.single.push(e.data[S][e.data[S].length-1].share.single),e.windows.multiple.push(e.data[S][e.data[S].length-1].share.multiple),e.windows.none.push(100-(e.windows.single[e.windows.single.length-1]+e.windows.multiple[e.windows.multiple.length-1])));return e},{chart:{},data:{},pie:{},windows:{}}),d=Object.entries(C.filter(e=>e.subBuilds[0].build.subBuilds.length).map(e=>{for(const n of e.subBuilds[0].build.subBuilds)if(n.jobName===Me&&n.result==="FAILURE")return{buildNumber:n.buildNumber,phases:n.phases}}).filter(e=>e).reduce((e,n)=>{for(const A of n.phases)A.result==="FAILURE"&&(e[A.jobName]||(e[A.jobName]=[]),e[A.jobName].push(n.buildNumber),++e.total);return e},{total:0})).reduce((e,n,A,T)=>(n[0]!=="total"&&(e[n[0]]={count:n[1].length,share:n[1].length/T[0][1]*100,builds:n[1]}),e),{});w({prs:P,platforms:F,windows:d})},[c,m]);const v=C=>{g(typeof C.target.value=="string"?JSON.parse(C.target.value):C.target.value)},I=(C,P)=>{p(P)},D=(C,P)=>{u(P)},O=C=>{h(C.target.value)},M=C=>{j(C.target.value)},H=(C,P)=>{b(P)};return s.jsxs("div",{className:Dt,children:[s.jsx(Q,{component:Ve,to:"/",children:"Back"}),s.jsx("h2",{children:"Dashboard"}),s.jsx("h4",{children:"Settings"}),s.jsxs(ce,{value:typeof o=="object"?JSON.stringify(o):o,onChange:v,children:[s.jsx($,{value:1,children:"1 day"}),s.jsx($,{value:7,children:"7 days"}),s.jsx($,{value:15,children:"15 days"}),s.jsx($,{value:30,children:"30 days"}),s.jsx($,{value:90,children:"90 days"}),s.jsx($,{value:180,children:"180 days"}),s.jsx($,{value:365,children:"365 days"}),s.jsx($,{value:JSON.stringify({start:new Date(2024,0).getTime(),end:new Date(2024,1).getTime()}),children:"January 2024"}),s.jsx($,{value:JSON.stringify({start:new Date(2024,1).getTime(),end:new Date(2024,2).getTime()}),children:"February 2024"}),s.jsx($,{value:JSON.stringify({start:new Date(2024,2).getTime(),end:new Date(2024,3).getTime()}),children:"March 2024"}),s.jsx($,{value:JSON.stringify({start:new Date(2024,3).getTime(),end:new Date(2024,4).getTime()}),children:"April 2024"}),s.jsx($,{value:JSON.stringify({start:new Date(2024,4).getTime(),end:new Date(2024,5).getTime()}),children:"May 2024"}),s.jsx($,{value:JSON.stringify({start:new Date(2024,5).getTime(),end:new Date(2024,6).getTime()}),children:"June 2024"}),s.jsx($,{value:JSON.stringify({start:new Date(2024,0).getTime(),end:new Date(2024,3).getTime()}),children:"Q1 2024"}),s.jsx($,{value:JSON.stringify({start:new Date(2024,3).getTime(),end:new Date(2024,6).getTime()}),children:"Q2 2024"}),s.jsx($,{value:JSON.stringify({start:new Date(2024,0).getTime(),end:new Date(2024,6).getTime()}),children:"H1 2024"})]}),"Duration",s.jsx(ue,{checked:r,onChange:I}),"Include flaky tests",s.jsx(ue,{checked:c,onChange:D}),"Include unstable builds",s.jsxs(ce,{value:l,onChange:O,children:[s.jsx($,{value:10,children:"10"}),s.jsx($,{value:20,children:"20"}),s.jsx($,{value:50,children:"50"}),s.jsx($,{value:100,children:"100"})]}),"Number of tests",s.jsxs(ce,{value:a,onChange:M,children:[s.jsx($,{value:"total",children:"Failures"}),s.jsx($,{value:"builds",children:"Builds"}),s.jsx($,{value:"prs",children:"PRs"})]}),"Sort tests by",s.jsx(ue,{checked:f,onChange:H}),"Exclude tests from single PR",s.jsx("hr",{}),s.jsx("h2",{children:"Windows"}),s.jsx("h4",{children:"Most failed tests"}),s.jsx(Lt,{includeFlaky:r,table:k.table,prs:m.prs}),s.jsx("h4",{children:"CI failures chart (Windows)"}),s.jsx(Nt,{chart:k.chart}),s.jsx("hr",{}),s.jsx("h2",{children:"CI"}),s.jsx("h4",{children:"CI failures chart (All)"}),s.jsx(Ot,{chart:y.prs}),s.jsx(ns,{chart:y.platforms.chart,data:y.platforms.data,pie:y.platforms.pie,windows:y.platforms.windows}),s.jsx("h4",{children:"Windows job failures"}),s.jsx(as,{windows:y.windows})]})};export{ds as Dashboard};
