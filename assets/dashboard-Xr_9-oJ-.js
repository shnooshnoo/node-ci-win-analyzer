import{a as Y,b as fe,s as be,i as Ue,h as We,_ as B,k as se,r as L,u as Ee,c as Q,l as _e,m as ze,j as s,d as we,f as xe,B as X,L as Ve}from"./index--nMlKWcO.js";import{L as Re,P as Ae,T as Ge,a as Qe,b as qe,c as Ce,d as q,e as Xe,f as Ke,g as Ye,S as ce,C as ue}from"./api-_UhTgD4U.js";import{w as Ze,h as Se,e as U,t as et,c as G,s as E,m as ge,a as Te,p as ke,b as K,d as H,f as z,g as De,i as tt,j as st,L as ye,k as Fe,u as nt,l as pe,I as it,n as at,o as lt,q as Be,S as ot,D as rt,R as dt,r as ct,C as ut,v as gt,x as ht,y as pt,B as me}from"./BarChart-w-4AfSeE.js";function mt(t){return t.innerRadius}function ft(t){return t.outerRadius}function bt(t){return t.startAngle}function xt(t){return t.endAngle}function yt(t){return t&&t.padAngle}function jt(t,a,o,g,r,p,c,u){var l=o-t,h=g-a,i=c-r,j=u-p,m=j*l-i*h;if(!(m*m<U))return m=(i*(a-p)-j*(t-r))/m,[t+m*l,a+m*h]}function ne(t,a,o,g,r,p,c){var u=t-o,l=a-g,h=(c?p:-p)/K(u*u+l*l),i=h*l,j=-h*u,m=t+i,b=a+j,f=o+i,v=g+j,T=(m+f)/2,x=(b+v)/2,y=f-m,A=v-b,w=y*y+A*A,k=r-p,O=m*v-f*b,$=(A<0?-1:1)*K(st(0,k*k*w-O*O)),M=(O*A-y*$)/w,J=(-O*y-A*$)/w,C=(O*A+y*$)/w,N=(-O*y+A*$)/w,F=M-T,d=J-x,e=C-T,n=N-x;return F*F+d*d>e*e+n*n&&(M=C,J=N),{cx:M,cy:J,x01:-i,y01:-j,x11:M*(r/k-1),y11:J*(r/k-1)}}function Je(){var t=mt,a=ft,o=z(0),g=null,r=bt,p=xt,c=yt,u=null,l=Ze(h);function h(){var i,j,m=+t.apply(this,arguments),b=+a.apply(this,arguments),f=r.apply(this,arguments)-Se,v=p.apply(this,arguments)-Se,T=Te(v-f),x=v>f;if(u||(u=i=l()),b<m&&(j=b,b=m,m=j),!(b>U))u.moveTo(0,0);else if(T>et-U)u.moveTo(b*G(f),b*E(f)),u.arc(0,0,b,f,v,!x),m>U&&(u.moveTo(m*G(v),m*E(v)),u.arc(0,0,m,v,f,x));else{var y=f,A=v,w=f,k=v,O=T,$=T,M=c.apply(this,arguments)/2,J=M>U&&(g?+g.apply(this,arguments):K(m*m+b*b)),C=ge(Te(b-m)/2,+o.apply(this,arguments)),N=C,F=C,d,e;if(J>U){var n=De(J/m*E(M)),R=De(J/b*E(M));(O-=n*2)>U?(n*=x?1:-1,w+=n,k-=n):(O=0,w=k=(f+v)/2),($-=R*2)>U?(R*=x?1:-1,y+=R,A-=R):($=0,y=A=(f+v)/2)}var D=b*G(y),P=b*E(y),W=m*G(k),S=m*E(k);if(C>U){var V=b*G(A),te=b*E(A),ie=m*G(w),ae=m*E(w),_;if(T<ke)if(_=jt(D,P,ie,ae,V,te,W,S)){var le=D-_[0],oe=P-_[1],re=V-_[0],de=te-_[1],je=1/E(tt((le*re+oe*de)/(K(le*le+oe*oe)*K(re*re+de*de)))/2),ve=K(_[0]*_[0]+_[1]*_[1]);N=ge(C,(m-ve)/(je-1)),F=ge(C,(b-ve)/(je+1))}else N=F=0}$>U?F>U?(d=ne(ie,ae,D,P,b,F,x),e=ne(V,te,W,S,b,F,x),u.moveTo(d.cx+d.x01,d.cy+d.y01),F<C?u.arc(d.cx,d.cy,F,H(d.y01,d.x01),H(e.y01,e.x01),!x):(u.arc(d.cx,d.cy,F,H(d.y01,d.x01),H(d.y11,d.x11),!x),u.arc(0,0,b,H(d.cy+d.y11,d.cx+d.x11),H(e.cy+e.y11,e.cx+e.x11),!x),u.arc(e.cx,e.cy,F,H(e.y11,e.x11),H(e.y01,e.x01),!x))):(u.moveTo(D,P),u.arc(0,0,b,y,A,!x)):u.moveTo(D,P),!(m>U)||!(O>U)?u.lineTo(W,S):N>U?(d=ne(W,S,V,te,m,-N,x),e=ne(D,P,ie,ae,m,-N,x),u.lineTo(d.cx+d.x01,d.cy+d.y01),N<C?u.arc(d.cx,d.cy,N,H(d.y01,d.x01),H(e.y01,e.x01),!x):(u.arc(d.cx,d.cy,N,H(d.y01,d.x01),H(d.y11,d.x11),!x),u.arc(0,0,m,H(d.cy+d.y11,d.cx+d.x11),H(e.cy+e.y11,e.cx+e.x11),x),u.arc(e.cx,e.cy,N,H(e.y11,e.x11),H(e.y01,e.x01),!x))):u.arc(0,0,m,k,w,x)}if(u.closePath(),i)return u=null,i+""||null}return h.centroid=function(){var i=(+t.apply(this,arguments)+ +a.apply(this,arguments))/2,j=(+r.apply(this,arguments)+ +p.apply(this,arguments))/2-ke/2;return[G(j)*i,E(j)*i]},h.innerRadius=function(i){return arguments.length?(t=typeof i=="function"?i:z(+i),h):t},h.outerRadius=function(i){return arguments.length?(a=typeof i=="function"?i:z(+i),h):a},h.cornerRadius=function(i){return arguments.length?(o=typeof i=="function"?i:z(+i),h):o},h.padRadius=function(i){return arguments.length?(g=i==null?null:typeof i=="function"?i:z(+i),h):g},h.startAngle=function(i){return arguments.length?(r=typeof i=="function"?i:z(+i),h):r},h.endAngle=function(i){return arguments.length?(p=typeof i=="function"?i:z(+i),h):p},h.padAngle=function(i){return arguments.length?(c=typeof i=="function"?i:z(+i),h):c},h.context=function(i){return arguments.length?(u=i??null,h):u},h}const vt=Y("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]),Ie=vt,wt=Y("MuiListItemIcon",["root","alignItemsFlexStart"]),Ne=wt,Rt=Y("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]),Oe=Rt;function At(t){return fe("MuiMenuItem",t)}const Ct=Y("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),Z=Ct,St=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],Tt=(t,a)=>{const{ownerState:o}=t;return[a.root,o.dense&&a.dense,o.divider&&a.divider,!o.disableGutters&&a.gutters]},kt=t=>{const{disabled:a,dense:o,divider:g,disableGutters:r,selected:p,classes:c}=t,l=xe({root:["root",o&&"dense",a&&"disabled",!r&&"gutters",g&&"divider",p&&"selected"]},At,c);return B({},c,l)},Dt=be(Ue,{shouldForwardProp:t=>We(t)||t==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:Tt})(({theme:t,ownerState:a})=>B({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!a.disableGutters&&{paddingLeft:16,paddingRight:16},a.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Z.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:se(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${Z.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:se(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${Z.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:se(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:se(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${Z.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${Z.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${Ie.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${Ie.inset}`]:{marginLeft:52},[`& .${Oe.root}`]:{marginTop:0,marginBottom:0},[`& .${Oe.inset}`]:{paddingLeft:36},[`& .${Ne.root}`]:{minWidth:36}},!a.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},a.dense&&B({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${Ne.root} svg`]:{fontSize:"1.25rem"}}))),It=L.forwardRef(function(a,o){const g=Ee({props:a,name:"MuiMenuItem"}),{autoFocus:r=!1,component:p="li",dense:c=!1,divider:u=!1,disableGutters:l=!1,focusVisibleClassName:h,role:i="menuitem",tabIndex:j,className:m}=g,b=Q(g,St),f=L.useContext(Re),v=L.useMemo(()=>({dense:c||f.dense||!1,disableGutters:l}),[f.dense,c,l]),T=L.useRef(null);_e(()=>{r&&T.current&&T.current.focus()},[r]);const x=B({},g,{dense:v.dense,divider:u,disableGutters:l}),y=kt(g),A=ze(T,o);let w;return g.disabled||(w=j!==void 0?j:-1),s.jsx(Re.Provider,{value:v,children:s.jsx(Dt,B({ref:A,role:i,tabIndex:w,component:p,focusVisibleClassName:we(y.focusVisible,h),className:we(y.root,m)},b,{ownerState:x,classes:y}))})}),I=It,he="_tableHeaderCell_tnbpf_1",Nt="_container_tnbpf_9";const Ot=({includeFlaky:t,table:a,prs:o})=>{const g=c=>{const u={};for(const l of c){const h=new Date(l.timestamp).toLocaleDateString();u[h]||(u[h]=0),++u[h]}return u},r=c=>{{const l=`https://ci.nodejs.org/job/${c.length&&c[0].buildUrl.includes("job/node-test-binary-windows-js-suites")?"node-test-binary-windows-js-suites":"node-test-binary-windows-native-suites"}/`,h=[...new Set(c.map(j=>`${l}${j.buildNumber}`))],i=c.map(j=>j.buildUrl);return{builds:h,urls:i}}},p=c=>{{const u={};for(const i of o)u[i.prId]=i.id;const l=[];for(const i of c)i.callStack.length&&i.callStack[i.callStack.length-1].prId&&!l.includes(+i.callStack[i.callStack.length-1].prId)&&l.push(+i.callStack[i.callStack.length-1].prId);const h=l.map(i=>`https://github.com/nodejs/node/pull/${i}`);return{prs:l,urls:h}}};return s.jsx(Ae,{children:s.jsx(Ge,{component:Ae,children:s.jsxs(Qe,{stickyHeader:!0,size:"small","aria-label":"a dense table",children:[s.jsx(qe,{children:s.jsxs(Ce,{children:[s.jsx(q,{className:he,children:"Name"}),s.jsxs(q,{className:he,children:["Failures",t?"(flaky)":""," / Builds / PRs"]}),s.jsx(q,{className:he,children:"Actions"})]})}),s.jsx(Xe,{children:a.map((c,u)=>s.jsxs(Ce,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[s.jsx(q,{component:"th",scope:"row",children:c[0]}),s.jsxs(q,{children:[c[1].total,c[1].flaky?s.jsxs("span",{children:["(",c[1].flaky,")"]}):null," / ",c[1].builds.length," / ",c[1].prs.length]}),s.jsxs(q,{children:[s.jsx(X,{onClick:()=>{window.open(`https://github.com/nodejs/reliability/issues?q=is%3Aissue+is%3Aopen+${encodeURI(c[0])}`)},children:"Reliability"}),s.jsx(X,{onClick:()=>{console.clear(),console.log(c[0]),console.log(c[1].data)},children:"Data"}),s.jsx(X,{onClick:()=>{console.clear(),console.log(c[0]),console.log(g(c[1].data))},children:"Chart"}),s.jsx(X,{onClick:()=>{console.clear(),console.log(c[0]),console.log(r(c[1].data))},onDoubleClick:()=>{for(const l of r(c[1].data).builds)window.open(l)},children:"Builds"}),s.jsx(X,{onClick:()=>{console.clear(),console.log(c[0]),console.log(p(c[1].data))},onDoubleClick:()=>{for(const l of p(c[1].data).urls)window.open(l)},children:"PRs"})]})]},u))})]})})})},Pt=({chart:t})=>{const[a,o]=L.useState(window.innerWidth),g=()=>{o(window.innerWidth-32)};return window.addEventListener("resize",g),s.jsx("div",{children:s.jsx(ye,{xAxis:[{data:t.map(r=>r[0]),scaleType:"point"}],series:[{label:"Tests",data:t.map(r=>r[1].tests)},{label:"Builds",data:t.map(r=>r[1].builds.length)},{label:"PRs",data:t.map(r=>r[1].prs.length)}],width:a,height:500})})},Lt=({chart:t})=>{const[a,o]=L.useState(window.innerWidth),g=()=>{o(window.innerWidth-32)};return window.addEventListener("resize",g),s.jsx("div",{children:s.jsx(ye,{xAxis:[{data:Object.entries(t).map(r=>r[0]),scaleType:"point"}],series:[{label:"Builds",data:Object.entries(t).map(r=>r[1].builds.length)},{label:"PRs",data:Object.entries(t).map(r=>r[1].prs.length)}],width:a,height:500})})},$t=["id","dataIndex","classes","color","highlightScope","onClick","isFaded","isHighlighted","startAngle","endAngle","paddingAngle","innerRadius","outerRadius","cornerRadius"];function Mt(t){return fe("MuiPieArc",t)}Y("MuiPieArc",["root","highlighted","faded"]);const Ft=t=>{const{classes:a,id:o,isFaded:g,isHighlighted:r}=t,p={root:["root",`series-${o}`,r&&"highlighted",g&&"faded"]};return xe(p,Mt,a)},Bt=be(Fe.path,{name:"MuiPieArc",slot:"Root",overridesResolver:(t,a)=>a.arc})(({theme:t})=>({stroke:(t.vars||t).palette.background.paper,strokeWidth:1,strokeLinejoin:"round"}));function Jt(t){const{id:a,dataIndex:o,classes:g,color:r,highlightScope:p,onClick:c,isFaded:u,isHighlighted:l,startAngle:h,endAngle:i,paddingAngle:j,innerRadius:m,outerRadius:b,cornerRadius:f}=t,v=Q(t,$t),T={id:a,dataIndex:o,classes:g,color:r,isFaded:u,isHighlighted:l},x=Ft(T),y=nt(p);return s.jsx(Bt,B({d:pe([h,i,j,m,b,f],(A,w,k,O,$,M)=>Je().cornerRadius(M)({padAngle:k,startAngle:A,endAngle:w,innerRadius:O,outerRadius:$})),onClick:c,cursor:c?"pointer":"unset",ownerState:T,className:x.root},v,y({type:"pie",seriesId:a,dataIndex:o})))}const Ht={keys:t=>t.id,from:({innerRadius:t,outerRadius:a,cornerRadius:o,startAngle:g,endAngle:r,paddingAngle:p,color:c,isFaded:u})=>({innerRadius:t,outerRadius:(t+a)/2,cornerRadius:o,startAngle:(g+r)/2,endAngle:(g+r)/2,paddingAngle:p,fill:c,opacity:u?.3:1}),leave:({innerRadius:t,startAngle:a,endAngle:o})=>({innerRadius:t,outerRadius:t,startAngle:(a+o)/2,endAngle:(a+o)/2}),enter:({innerRadius:t,outerRadius:a,startAngle:o,endAngle:g})=>({innerRadius:t,outerRadius:a,startAngle:o,endAngle:g}),update:({innerRadius:t,outerRadius:a,cornerRadius:o,startAngle:g,endAngle:r,paddingAngle:p,color:c,isFaded:u})=>({innerRadius:t,outerRadius:a,cornerRadius:o,startAngle:g,endAngle:r,paddingAngle:p,fill:c,opacity:u?.3:1}),config:{tension:120,friction:14,clamp:!0}},Ut={keys:t=>t.id,from:({innerRadius:t,outerRadius:a,cornerRadius:o,startAngle:g,endAngle:r,paddingAngle:p})=>({innerRadius:t,outerRadius:(t+a)/2,cornerRadius:o,startAngle:(g+r)/2,endAngle:(g+r)/2,paddingAngle:p,opacity:0}),leave:({innerRadius:t,startAngle:a,endAngle:o})=>({innerRadius:t,outerRadius:t,startAngle:(a+o)/2,endAngle:(a+o)/2,opacity:0}),enter:({innerRadius:t,outerRadius:a,startAngle:o,endAngle:g})=>({innerRadius:t,outerRadius:a,startAngle:o,endAngle:g,opacity:1}),update:({innerRadius:t,outerRadius:a,cornerRadius:o,startAngle:g,endAngle:r,paddingAngle:p})=>({innerRadius:t,outerRadius:a,cornerRadius:o,startAngle:g,endAngle:r,paddingAngle:p,opacity:1}),config:{tension:120,friction:14,clamp:!0}};function He(t){const{id:a,highlightScope:o,data:g,faded:r,highlighted:p,paddingAngle:c=0,innerRadius:u=0,outerRadius:l,cornerRadius:h=0}=t,{item:i}=L.useContext(it),j=L.useCallback(b=>{const f=at(i,{type:"pie",seriesId:a,dataIndex:b},o),v=!f&&lt(i,{type:"pie",seriesId:a,dataIndex:b},o);return{isHighlighted:f,isFaded:v}},[o,i,a]);return L.useMemo(()=>g.map((b,f)=>{var v,T,x,y;const{isHighlighted:A,isFaded:w}=j(f),k=B({additionalRadius:0},w&&r||A&&p||{}),O=Math.max(0,Math.PI*((v=k.paddingAngle)!=null?v:c)/180),$=Math.max(0,(T=k.innerRadius)!=null?T:u),M=Math.max(0,(x=k.outerRadius)!=null?x:l+k.additionalRadius),J=(y=k.cornerRadius)!=null?y:h;return B({},b,k,{isFaded:w,isHighlighted:A,paddingAngle:O,innerRadius:$,outerRadius:M,cornerRadius:J})}),[h,u,l,c,g,r,j,p])}const Wt=["slots","slotProps","innerRadius","outerRadius","cornerRadius","paddingAngle","id","highlightScope","highlighted","faded","data","onClick","skipAnimation"],Et=["startAngle","endAngle","paddingAngle","innerRadius","outerRadius","cornerRadius"];function _t(t){var a;const{slots:o,slotProps:g,innerRadius:r=0,outerRadius:p,cornerRadius:c=0,paddingAngle:u=0,id:l,highlightScope:h,highlighted:i,faded:j={additionalRadius:-5},data:m,onClick:b,skipAnimation:f}=t,v=Q(t,Wt),T=He({innerRadius:r,outerRadius:p,cornerRadius:c,paddingAngle:u,id:l,highlightScope:h,highlighted:i,faded:j,data:m}),x=Be(T,B({},Ht,{immediate:f}));if(m.length===0)return null;const y=(a=o==null?void 0:o.pieArc)!=null?a:Jt;return s.jsx("g",B({},v,{children:x((A,w,k,O)=>{let{startAngle:$,endAngle:M,paddingAngle:J,innerRadius:C,outerRadius:N,cornerRadius:F}=A,d=Q(A,Et);return s.jsx(y,B({startAngle:$,endAngle:M,paddingAngle:J,innerRadius:C,outerRadius:N,cornerRadius:F,style:d,id:l,color:w.color,dataIndex:O,highlightScope:h,isFaded:w.isFaded,isHighlighted:w.isHighlighted,onClick:b&&(e=>{b(e,{type:"pie",seriesId:l,dataIndex:O},w)})},g==null?void 0:g.pieArc))})}))}const zt=["id","classes","color","startAngle","endAngle","paddingAngle","innerRadius","outerRadius","cornerRadius","formattedArcLabel","isHighlighted","isFaded","style"];function Vt(t){return fe("MuiPieArcLabel",t)}Y("MuiPieArcLabel",["root","highlighted","faded"]);const Gt=t=>{const{classes:a,id:o,isFaded:g,isHighlighted:r}=t,p={root:["root",`series-${o}`,r&&"highlighted",g&&"faded"]};return xe(p,Vt,a)},Qt=be(Fe.text,{name:"MuiPieArcLabel",slot:"Root",overridesResolver:(t,a)=>a.root})(({theme:t})=>({fill:(t.vars||t).palette.text.primary,textAnchor:"middle",dominantBaseline:"middle"})),Pe=(t,a)=>(o,g,r,p,c,u)=>{if(!t)return 0;const[l,h]=Je().cornerRadius(u).centroid({padAngle:r,startAngle:o,endAngle:g,innerRadius:p,outerRadius:c});return a==="x"?l:h};function qt(t){const{id:a,classes:o,color:g,startAngle:r,endAngle:p,paddingAngle:c,innerRadius:u,outerRadius:l,cornerRadius:h,formattedArcLabel:i,isHighlighted:j,isFaded:m,style:b}=t,f=Q(t,zt),T=Gt({id:a,classes:o,color:g,isFaded:m,isHighlighted:j});return s.jsx(Qt,B({className:T.root},f,{style:B({x:pe([r,p,c,u,l,h],Pe(i,"x")),y:pe([r,p,c,u,l,h],Pe(i,"y"))},b),children:i}))}const Xt=["slots","slotProps","innerRadius","outerRadius","cornerRadius","paddingAngle","id","highlightScope","highlighted","faded","data","arcLabel","arcLabelMinAngle","skipAnimation"],Kt=["startAngle","endAngle","paddingAngle","innerRadius","outerRadius","cornerRadius"],Yt=180/Math.PI;function Zt(t,a,o){if(!t||(o.endAngle-o.startAngle)*Yt<a)return null;if(typeof t=="string"){var r;return(r=o[t])==null?void 0:r.toString()}return t(o)}function es(t){var a;const{slots:o,slotProps:g,innerRadius:r=0,outerRadius:p,cornerRadius:c=0,paddingAngle:u=0,id:l,highlightScope:h,highlighted:i,faded:j={additionalRadius:-5},data:m,arcLabel:b,arcLabelMinAngle:f=0,skipAnimation:v}=t,T=Q(t,Xt),x=He({innerRadius:r,outerRadius:p,cornerRadius:c,paddingAngle:u,id:l,highlightScope:h,highlighted:i,faded:j,data:m}),y=Be(x,B({},Ut,{immediate:v}));if(m.length===0)return null;const A=(a=o==null?void 0:o.pieArcLabel)!=null?a:qt;return s.jsx("g",B({},T,{children:y((w,k)=>{let{startAngle:O,endAngle:$,paddingAngle:M,innerRadius:J,outerRadius:C,cornerRadius:N}=w,F=Q(w,Kt);return s.jsx(A,B({startAngle:O,endAngle:$,paddingAngle:M,innerRadius:J,outerRadius:C,cornerRadius:N,style:F,id:l,color:k.color,isFaded:k.isFaded,isHighlighted:k.isHighlighted,formattedArcLabel:Zt(b,f,k)},g==null?void 0:g.pieArcLabel))})}))}function ts(t){const{skipAnimation:a,slots:o,slotProps:g,onClick:r}=t,p=L.useContext(ot).pie,{left:c,top:u,width:l,height:h}=L.useContext(rt);if(p===void 0)return null;const i=Math.min(l,h)/2,j={x:c+l/2,y:u+h/2},{series:m,seriesOrder:b}=p;return s.jsxs("g",{children:[b.map(f=>{const{innerRadius:v,outerRadius:T,cornerRadius:x,paddingAngle:y,data:A,cx:w,cy:k,highlighted:O,faded:$,highlightScope:M}=m[f];return s.jsx("g",{transform:`translate(${w===void 0?j.x:c+w}, ${k===void 0?j.y:u+k})`,children:s.jsx(_t,{innerRadius:v,outerRadius:T??i,cornerRadius:x,paddingAngle:y,id:f,data:A,skipAnimation:a,highlightScope:M,highlighted:O,faded:$,onClick:r,slots:o,slotProps:g})},f)}),b.map(f=>{const{innerRadius:v,outerRadius:T,cornerRadius:x,paddingAngle:y,arcLabel:A,arcLabelMinAngle:w,data:k,cx:O,cy:$,highlightScope:M}=m[f];return s.jsx("g",{transform:`translate(${O===void 0?j.x:c+O}, ${$===void 0?j.y:u+$})`,children:s.jsx(es,{innerRadius:v,outerRadius:T??i,cornerRadius:x,paddingAngle:y,id:f,data:k,skipAnimation:a,arcLabel:A,arcLabelMinAngle:w,highlightScope:M})},f)})]})}const ss={top:5,bottom:5,left:5,right:100};function Le(t){const{xAxis:a,yAxis:o,series:g,width:r,height:p,margin:c,colors:u,sx:l,tooltip:h={trigger:"item"},axisHighlight:i={x:"none",y:"none"},skipAnimation:j,legend:m={direction:"column",position:{vertical:"middle",horizontal:"right"}},topAxis:b=null,leftAxis:f=null,rightAxis:v=null,bottomAxis:T=null,children:x,slots:y,slotProps:A,onClick:w}=t,k=B({},ss,c);return s.jsxs(dt,{series:g.map(O=>B({type:"pie"},O)),width:r,height:p,margin:k,xAxis:a??[{id:ct,scaleType:"point",data:[...new Array(Math.max(...g.map(O=>O.data.length)))].map((O,$)=>$)}],yAxis:o,colors:u,sx:l,disableAxisListener:(h==null?void 0:h.trigger)!=="axis"&&(i==null?void 0:i.x)==="none"&&(i==null?void 0:i.y)==="none",children:[s.jsx(ut,{topAxis:b,leftAxis:f,rightAxis:v,bottomAxis:T,slots:y,slotProps:A}),s.jsx(ts,{slots:y,slotProps:A,onClick:w,skipAnimation:j}),s.jsx(gt,B({},m,{slots:y,slotProps:A})),s.jsx(ht,B({},i)),s.jsx(pt,B({},h)),x]})}const ns=({chart:t,data:a,pie:o,windows:g})=>{const r=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf","#aec7e8","#ffbb78","#98df8a","#ff9896","#c5b0d5","#c49c94","#f7b6d2","#c7c7c7","#dbdb8d","#9edae5"],[p,c]=L.useState(window.innerWidth),u=()=>{c(window.innerWidth-32)};return window.addEventListener("resize",u),s.jsxs("div",{children:[s.jsx("h4",{children:"Failures count by platform"}),s.jsx(ye,{colors:r,xAxis:[{data:Object.entries(t).map(l=>l[0]),scaleType:"point"}],series:Object.entries(a).map(l=>({label:l[0],data:l[1].map(h=>h.count.single)})),width:p,height:500}),s.jsx("h4",{children:"Failures share by platform"}),s.jsx(me,{colors:r,xAxis:[{data:Object.entries(t).map(l=>l[0]),scaleType:"band"}],series:Object.entries(a).map(l=>({label:l[0],data:l[1].map(h=>h.share.single),stack:"total",stackOrder:"descending"})),width:p,height:500}),s.jsx("h4",{children:"Failures pie chart by platform (excluding multiplatform failures)"}),s.jsx(Le,{colors:r,series:[{arcLabel:l=>{const h=(l.endAngle-l.startAngle)/(2*Math.PI)*100;return`${l.label} ${h.toFixed(0)}%`},arcLabelMinAngle:20,data:Object.entries(o).filter(l=>l[0]!=="Multiplatform").map(l=>({label:l[0],value:l[1].single})),highlightScope:{faded:"global",highlighted:"item"},faded:{innerRadius:50,additionalRadius:-50,color:"gray"}}],width:p,height:900}),s.jsx("h4",{children:"Failures pie chart by platform (including multiplatform failures)"}),s.jsx(Le,{colors:r,series:[{arcLabel:l=>{const h=(l.endAngle-l.startAngle)/(2*Math.PI)*100;return`${l.label} ${h.toFixed(0)}%`},arcLabelMinAngle:20,data:Object.entries(o).filter(l=>l[0]!=="Multiplatform").map(l=>({label:l[0],value:l[1].multiple})),highlightScope:{faded:"global",highlighted:"item"},faded:{innerRadius:50,additionalRadius:-50,color:"gray"}}],width:p,height:900}),s.jsx("h4",{children:"Failures share for Windows"}),s.jsx(me,{xAxis:[{data:Object.entries(t).map(l=>l[0]),scaleType:"band"}],series:Object.entries(g).map(l=>({label:l[0]==="single"?"Windows only failures":l[0]==="multiple"?"Windows joined failures":"Other platform failures",data:l[1],stack:"total",color:l[0]==="single"?"red":l[0]==="multiple"?"yellow":"green"})),width:p,height:500})]})},is=({windows:t})=>{const a=Object.entries(t).reverse(),[o,g]=L.useState(window.innerWidth),r=()=>{g(window.innerWidth-32)};return window.addEventListener("resize",r),s.jsx("div",{children:s.jsx(me,{xAxis:[{data:a.map(p=>p[0]),scaleType:"band"}],series:[{data:a.length?a.map(p=>p[1].share):[0]}],width:o,height:500})})},as="node-test-commit",$e="node-test-commit-multiple",Me="node-test-commit-windows-fanned",ee={"node-test-commit":"No build","node-test-commit-multiple":"Multiplatform","node-test-linter":"Linter","node-test-commit-freebsd":"FreeBSD","node-test-commit-linux":"Linux","node-test-commit-osx":"macOS","node-test-commit-plinux":"Linux","node-test-commit-smartos":"SmartOS","node-test-commit-windows-fanned":"Windows","node-test-commit-linux-containered":"Linux","node-test-commit-arm":"ARM","node-test-commit-linuxone":"Linux","node-test-commit-aix":"AIX","node-test-commit-arm-fanned":"ARM","node-test-commit-custom-suites-freestyle":"Linux","node-test-commit-osx-arm":"macOS","node-test-commit-arm-debug":"ARM"},ds=()=>{const[t,a]=L.useState({tests:[],prs:[]}),[o,g]=L.useState(7),[r,p]=L.useState(!1),[c,u]=L.useState(!1),[l,h]=L.useState(10),[i,j]=L.useState("total"),[m,b]=L.useState(!1),[f,v]=L.useState({tests:[],prs:[]}),[T,x]=L.useState({table:[],chart:[]}),[y,A]=L.useState({prs:{},platforms:{chart:{},data:{},pie:{},windows:{}},windows:{}});L.useEffect(()=>{Ke().then(({data:C})=>{Ye(c).then(({data:N})=>{a({tests:C,prs:N})})})},[c]),L.useEffect(()=>{const C=(o==null?void 0:o.start)||Date.now()-o*24*60*60*1e3,N=(o==null?void 0:o.end)||Date.now(),F=t.tests.filter(e=>{var P;const n=e.timestamp>=C&&N>=e.timestamp,R=typeof((P=e==null?void 0:e.tap)==null?void 0:P.todo)=="string"&&e.tap.todo.includes("Fix flaky test");return n&&(r||!R)}),d=t.prs.filter(e=>{const n=new Date(e.date);return n>=C&&N>=n});v({tests:F,prs:d})},[t,o,r]),L.useEffect(()=>{const C={};for(const d of f.prs)C[d.prId]=d.id;const N=Object.entries(f.tests.reduce((d,e)=>{var n;return d[e.testName]||(d[e.testName]={total:0,flaky:0,builds:[],prs:[],data:[]}),++d[e.testName].total,typeof((n=e==null?void 0:e.tap)==null?void 0:n.todo)=="string"&&e.tap.todo.includes("Fix flaky test")&&++d[e.testName].flaky,d[e.testName].builds.includes(e.buildNumber)||d[e.testName].builds.push(e.buildNumber),e.callStack.length&&e.callStack[e.callStack.length-1].prId&&!d[e.testName].prs.includes(e.callStack[e.callStack.length-1].prId)&&d[e.testName].prs.push(e.callStack[e.callStack.length-1].prId),d[e.testName].data.push(e),d},{})).filter(d=>!m||d[1].prs.length>1).sort((d,e)=>{var D,P;const n=((D=d[1][i])==null?void 0:D.length)||d[1][i],R=((P=e[1][i])==null?void 0:P.length)||e[1][i];return n>R?-1:1}).slice(0,l),F=Object.entries(f.tests.reduce((d,e)=>{const n=new Date(e.timestamp).toLocaleDateString();return d[n]||(d[n]={tests:0,builds:[],prs:[]}),++d[n].tests,d[n].builds.includes(e.buildNumber)||d[n].builds.push(e.buildNumber),e.callStack.length&&e.callStack[e.callStack.length-1].prId&&!d[n].prs.includes(e.callStack[e.callStack.length-1].prId)&&d[n].prs.push(e.callStack[e.callStack.length-1].prId),d},{})).reverse();x({table:N,chart:F})},[l,i,m,f]),L.useEffect(()=>{const C=f.prs.filter(e=>{var P,W,S,V;const n=e.subBuilds.length&&typeof((W=(P=e.subBuilds[0])==null?void 0:P.build)==null?void 0:W.result)=="string",R=((V=(S=e.subBuilds[0])==null?void 0:S.build)==null?void 0:V.result)==="UNSTABLE";return n&&(c||!R)}).reverse(),N=C.reduce((e,n)=>{e[n.date]||(e[n.date]={builds:[],prs:[],platforms:{}}),e[n.date].builds.includes(n.id)||e[n.date].builds.push(n.id),e[n.date].prs.includes(n.prId)||e[n.date].prs.push(n.prId);const R=[...new Set(n.subBuilds[0].build.subBuilds.filter(D=>{const P=D.result==="FAILURE",W=D.result==="UNSTABLE";return P&&(c||!W)}).map(D=>ee[D.jobName]))];if(R.length===1)e[n.date].platforms[R[0]]||(e[n.date].platforms[R[0]]={builds:[],prs:[]}),e[n.date].platforms[R[0]].builds.includes(n.id)||e[n.date].platforms[R[0]].builds.push(n.id),e[n.date].platforms[R[0]].prs.includes(n.prId)||e[n.date].platforms[R[0]].prs.push(n.prId);else{const D=ee[R.length?$e:as];e[n.date].platforms[D]||(e[n.date].platforms[D]={builds:[],prs:[],platforms:{}}),e[n.date].platforms[D].builds.includes(n.id)||e[n.date].platforms[D].builds.push(n.id),e[n.date].platforms[D].prs.includes(n.prId)||e[n.date].platforms[D].prs.push(n.prId);for(const P of R)e[n.date].platforms[D].platforms[P]||(e[n.date].platforms[D].platforms[P]={builds:[],prs:[]}),e[n.date].platforms[D].platforms[P].builds.includes(n.id)||e[n.date].platforms[D].platforms[P].builds.push(n.id),e[n.date].platforms[D].platforms[P].prs.includes(n.prId)||e[n.date].platforms[D].platforms[P].prs.push(n.prId)}return e},{}),F=Object.entries(N).reduce((e,n,R)=>{var D,P,W;e.chart[n[0]]={total:n[1].builds.length};for(const S of Object.values(ee))e.chart[n[0]][S]={single:((D=n[1].platforms[S])==null?void 0:D.builds.length)||0,multiple:((W=(P=n[1].platforms[ee[$e]])==null?void 0:P.platforms[S])==null?void 0:W.builds.length)||0},e.data[S]||(e.data[S]=[]),e.data[S][R]||(e.data[S][R]={count:{single:0,multiple:0},share:{single:0,multiple:0}}),e.data[S][R].count.single=e.chart[n[0]][S].single,e.data[S][R].count.multiple=e.chart[n[0]][S].multiple,e.data[S][R].share.single=e.data[S][R].count.single/n[1].builds.length*100,e.data[S][R].share.multiple=e.data[S][R].count.multiple/n[1].builds.length*100,e.pie[S]||(e.pie[S]={single:0,multiple:0}),e.pie[S].single+=e.chart[n[0]][S].single,e.pie[S].multiple+=e.chart[n[0]][S].multiple,S===ee[Me]&&((!e.windows.single||!e.windows.multiple)&&(e.windows.single=[],e.windows.multiple=[],e.windows.none=[]),e.windows.single.push(e.data[S][e.data[S].length-1].share.single),e.windows.multiple.push(e.data[S][e.data[S].length-1].share.multiple),e.windows.none.push(100-(e.windows.single[e.windows.single.length-1]+e.windows.multiple[e.windows.multiple.length-1])));return e},{chart:{},data:{},pie:{},windows:{}}),d=Object.entries(C.filter(e=>e.subBuilds[0].build.subBuilds.length).map(e=>{for(const n of e.subBuilds[0].build.subBuilds)if(n.jobName===Me&&n.result==="FAILURE")return{buildNumber:n.buildNumber,phases:n.phases}}).filter(e=>e).reduce((e,n)=>{for(const R of n.phases)R.result==="FAILURE"&&(e[R.jobName]||(e[R.jobName]=[]),e[R.jobName].push(n.buildNumber),++e.total);return e},{total:0})).reduce((e,n,R,D)=>(n[0]!=="total"&&(e[n[0]]={count:n[1].length,share:n[1].length/D[0][1]*100,builds:n[1]}),e),{});A({prs:N,platforms:F,windows:d})},[c,f]);const w=C=>{g(typeof C.target.value=="string"?JSON.parse(C.target.value):C.target.value)},k=(C,N)=>{p(N)},O=(C,N)=>{u(N)},$=C=>{h(C.target.value)},M=C=>{j(C.target.value)},J=(C,N)=>{b(N)};return s.jsxs("div",{className:Nt,children:[s.jsx(X,{component:Ve,to:"/",children:"Back"}),s.jsx("h2",{children:"Dashboard"}),s.jsx("h4",{children:"Settings"}),s.jsxs(ce,{value:typeof o=="object"?JSON.stringify(o):o,onChange:w,children:[s.jsx(I,{value:1,children:"1 day"}),s.jsx(I,{value:7,children:"7 days"}),s.jsx(I,{value:15,children:"15 days"}),s.jsx(I,{value:30,children:"30 days"}),s.jsx(I,{value:90,children:"90 days"}),s.jsx(I,{value:180,children:"180 days"}),s.jsx(I,{value:365,children:"365 days"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,0).getTime(),end:new Date(2024,1).getTime()}),children:"January 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,1).getTime(),end:new Date(2024,2).getTime()}),children:"February 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,2).getTime(),end:new Date(2024,3).getTime()}),children:"March 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,3).getTime(),end:new Date(2024,4).getTime()}),children:"April 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,4).getTime(),end:new Date(2024,5).getTime()}),children:"May 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,5).getTime(),end:new Date(2024,6).getTime()}),children:"June 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,6).getTime(),end:new Date(2024,7).getTime()}),children:"July 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,7).getTime(),end:new Date(2024,8).getTime()}),children:"August 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,8).getTime(),end:new Date(2024,9).getTime()}),children:"September 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,9).getTime(),end:new Date(2024,10).getTime()}),children:"October 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,10).getTime(),end:new Date(2024,11).getTime()}),children:"November 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,11).getTime(),end:new Date(2025,0).getTime()}),children:"December 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,0).getTime(),end:new Date(2024,3).getTime()}),children:"Q1 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,3).getTime(),end:new Date(2024,6).getTime()}),children:"Q2 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,6).getTime(),end:new Date(2024,9).getTime()}),children:"Q3 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,9).getTime(),end:new Date(2025,0).getTime()}),children:"Q4 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,0).getTime(),end:new Date(2024,6).getTime()}),children:"H1 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,6).getTime(),end:new Date(2025,0).getTime()}),children:"H2 2024"}),s.jsx(I,{value:JSON.stringify({start:new Date(2024,0).getTime(),end:new Date(2025,0).getTime()}),children:"2024"})]}),"Duration",s.jsx(ue,{checked:r,onChange:k}),"Include flaky tests",s.jsx(ue,{checked:c,onChange:O}),"Include unstable builds",s.jsxs(ce,{value:l,onChange:$,children:[s.jsx(I,{value:10,children:"10"}),s.jsx(I,{value:20,children:"20"}),s.jsx(I,{value:50,children:"50"}),s.jsx(I,{value:100,children:"100"})]}),"Number of tests",s.jsxs(ce,{value:i,onChange:M,children:[s.jsx(I,{value:"total",children:"Failures"}),s.jsx(I,{value:"builds",children:"Builds"}),s.jsx(I,{value:"prs",children:"PRs"})]}),"Sort tests by",s.jsx(ue,{checked:m,onChange:J}),"Exclude tests from single PR",s.jsx("hr",{}),s.jsx("h2",{children:"Windows"}),s.jsx("h4",{children:"Most failed tests"}),s.jsx(Ot,{includeFlaky:r,table:T.table,prs:f.prs}),s.jsx("h4",{children:"CI failures chart (Windows)"}),s.jsx(Pt,{chart:T.chart}),s.jsx("hr",{}),s.jsx("h2",{children:"CI"}),s.jsx("h4",{children:"CI failures chart (All)"}),s.jsx(Lt,{chart:y.prs}),s.jsx(ns,{chart:y.platforms.chart,data:y.platforms.data,pie:y.platforms.pie,windows:y.platforms.windows}),s.jsx("h4",{children:"Windows job failures"}),s.jsx(is,{windows:y.windows})]})};export{ds as Dashboard};
