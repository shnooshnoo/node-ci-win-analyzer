import{j as e,r as o,B as $,L as z}from"./index--nMlKWcO.js";import{f as L,C as k,P as x,T as F,a as C,b as y,c as j,d as t,e as I}from"./api-_UhTgD4U.js";import{T as b}from"./TextField-yDwlgEe5.js";const r="_tableHeaderCell_1witl_1",U="_filterBox_1witl_9",J="_checkBoxContainer_1witl_21",M="_testsFailuresHeader_1witl_33";const V=({callStack:a})=>{if(a.length===0)return null;const i=a[a.length-1];return i.prId?e.jsxs("a",{target:"_blank",rel:"noreferrer",href:`https://github.com/nodejs/node/pull/${i.prId}`,children:["PR ",i.prId]}):e.jsxs("a",{href:`https://ci.nodejs.org/${i.upstreamUrl}${i.upstreamBuild}`,target:"_blank",rel:"noreferrer",children:[i.upstreamProject,", ",i.upstreamBuild]})},f=a=>{var i;return typeof((i=a==null?void 0:a.tap)==null?void 0:i.todo)!="string"?!1:a.tap.todo.includes("Fix flaky test")},Y=({count:a})=>a?e.jsxs("span",{children:["(",a," flaky)"]}):null,Q=()=>{const[a,i]=o.useState([]),[S,_]=o.useState([]),[D,T]=o.useState([]),[h,v]=o.useState(""),[u,B]=o.useState(""),[m,H]=o.useState(""),[p,w]=o.useState(!0),[N,E]=o.useState(!0);o.useEffect(()=>{L().then(({data:s})=>{i(s)})},[]),o.useEffect(()=>{const s=Date.now()-12096e5,d=a.reduce((n,l)=>{if(l.timestamp<s||!p&&f(l))return n;const c={...n};return c[l.testName]===void 0&&(c[l.testName]={failures:0,flakyFailures:0}),c[l.testName].failures++,f(l)&&c[l.testName].flakyFailures++,c},{}),g=Object.entries(d);g.sort((n,l)=>n[1].failures>l[1].failures?-1:1),_(g.slice(0,10)),T(a.map(n=>{if(h.length&&!n.testName.includes(h))return null;if(u.length){const l=new Date(n.timestamp).getTime(),c=new Date(u).getTime();if(isNaN(l)||isNaN(c)||l<c)return null}if(m.length){const l=new Date(n.timestamp).getTime(),c=new Date(m).getTime();if(isNaN(l)||isNaN(c)||l>c)return null}return!N&&f(n)?null:n}).filter(n=>n!==null).slice(0,100))},[a,u,m,p,N,T,h]);const O=s=>{v(s.target.value.trim())},P=s=>{B(s.target.value.trim())},A=s=>{H(s.target.value.trim())},R=(s,d)=>{w(d)},W=(s,d)=>{E(d)};return e.jsxs(e.Fragment,{children:[e.jsx($,{component:z,to:"/",children:"Back"}),e.jsx("h3",{children:"Most failed tests"}),e.jsx(k,{checked:p,onChange:R}),"Include flaky tests",e.jsx(x,{sx:{width:1200,overflow:"hidden"},children:e.jsx(F,{component:x,children:e.jsxs(C,{stickyHeader:!0,size:"small","aria-label":"a dense table",children:[e.jsx(y,{children:e.jsxs(j,{children:[e.jsx(t,{className:r,children:"Test name"}),e.jsx(t,{className:r,children:"Number of failures in the past two weeks"})]})}),e.jsx(I,{children:S.map((s,d)=>e.jsxs(j,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{component:"th",scope:"row",children:s[0]}),e.jsxs(t,{children:[s[1].failures," ",e.jsx(Y,{count:s[1].flakyFailures})]})]},d))})]})})}),e.jsx("h3",{className:M,children:"All test failures"}),e.jsxs("div",{className:U,children:[e.jsx(b,{id:"standard-basic",label:"Name",variant:"standard",value:h,onChange:O}),e.jsx(b,{id:"standard-basic",label:"Date from",variant:"standard",value:u,onChange:P}),e.jsx(b,{id:"standard-basic",label:"Date to",variant:"standard",value:m,onChange:A}),e.jsxs("div",{className:J,children:[e.jsx(k,{checked:N,onChange:W}),e.jsx("span",{children:"Include flaky tests"})]})]}),e.jsx(x,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(F,{component:x,children:e.jsxs(C,{stickyHeader:!0,size:"small","aria-label":"a dense table",children:[e.jsx(y,{children:e.jsxs(j,{children:[e.jsx(t,{className:r,children:"#"}),e.jsx(t,{className:r,children:"Test name"}),e.jsx(t,{className:r,children:"Is Flaky"}),e.jsx(t,{className:r,children:"Job"}),e.jsx(t,{className:r,children:"Config"}),e.jsx(t,{className:r,children:"Status"}),e.jsx(t,{className:r,children:"Node"}),e.jsx(t,{className:r,sx:{minWidth:75},children:"Date"}),e.jsx(t,{className:r,children:"Build"}),e.jsx(t,{className:r,children:"Built On"}),e.jsx(t,{className:r,children:"Source"})]})}),e.jsx(I,{children:D.map((s,d)=>e.jsxs(j,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{component:"th",scope:"row",children:d+1}),e.jsx(t,{children:s.testName}),e.jsx(t,{children:f(s)?"Yes":"No"}),e.jsx(t,{children:s.jobName}),e.jsx(t,{children:s.config}),e.jsx(t,{children:s.status}),e.jsx(t,{children:s.nodeVersion}),e.jsx(t,{sx:{minWidth:200},children:new Date(s.timestamp).toISOString()}),e.jsx(t,{children:e.jsx("a",{href:s.buildUrl,target:"_blank",rel:"noreferrer",children:s.buildNumber})}),e.jsx(t,{children:s.builtOn}),e.jsx(t,{children:e.jsx(V,{callStack:s.callStack})})]},d))})]})})})]})};export{Q as Tests};
