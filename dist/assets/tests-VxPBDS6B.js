import{j as e,r as o,B as W,L as $}from"./index-mGEfc9Pb.js";import{f as z,C as k,P as x,T as F,a as C,b as y,c as j,d as t,e as v,g as p}from"./api-UqdYsVnm.js";const r="_tableHeaderCell_qov20_1",L="_filterBox_qov20_5",U="_checkBoxContainer_qov20_11",J="_testsFailuresHeader_qov20_17";const M=({callStack:a})=>{if(a.length===0)return null;const i=a[a.length-1];return i.prId?e.jsxs("a",{target:"_blank",rel:"noreferrer",href:`https://github.com/nodejs/node/pull/${i.prId}`,children:["PR ",i.prId]}):e.jsxs("a",{href:`https://ci.nodejs.org/${i.upstreamUrl}${i.upstreamBuild}`,target:"_blank",rel:"noreferrer",children:[i.upstreamProject,", ",i.upstreamBuild]})},f=a=>{var i;return typeof((i=a==null?void 0:a.tap)==null?void 0:i.todo)!="string"?!1:a.tap.todo.includes("Fix flaky test")},V=({count:a})=>a?e.jsxs("span",{children:["(",a," flaky)"]}):null,K=()=>{const[a,i]=o.useState([]),[I,S]=o.useState([]),[_,T]=o.useState([]),[h,D]=o.useState(""),[u,B]=o.useState(""),[m,H]=o.useState(""),[N,q]=o.useState(!0),[b,w]=o.useState(!0);o.useEffect(()=>{z().then(({data:s})=>{i(s)})},[]),o.useEffect(()=>{const s=Date.now()-12096e5,d=a.reduce((l,n)=>{if(n.timestamp<s||!N&&f(n))return l;const c={...l};return c[n.testName]===void 0&&(c[n.testName]={failures:0,flakyFailures:0}),c[n.testName].failures++,f(n)&&c[n.testName].flakyFailures++,c},{}),g=Object.entries(d);g.sort((l,n)=>l[1].failures>n[1].failures?-1:1),S(g.slice(0,10)),T(a.map(l=>{if(h.length&&!l.testName.includes(h))return null;if(u.length){const n=new Date(l.timestamp).getTime(),c=new Date(u).getTime();if(isNaN(n)||isNaN(c)||n<c)return null}if(m.length){const n=new Date(l.timestamp).getTime(),c=new Date(m).getTime();if(isNaN(n)||isNaN(c)||n>c)return null}return!b&&f(l)?null:l}).filter(l=>l!==null).slice(0,100))},[a,u,m,N,b,T,h]);const E=s=>{D(s.target.value.trim())},O=s=>{B(s.target.value.trim())},P=s=>{H(s.target.value.trim())},A=(s,d)=>{q(d)},R=(s,d)=>{w(d)};return e.jsxs(e.Fragment,{children:[e.jsx(W,{component:$,to:"/",children:"Back"}),e.jsx("h3",{children:"Most failed tests"}),e.jsx(k,{checked:N,onChange:A}),"Include flaky tests",e.jsx(x,{sx:{width:1200,overflow:"hidden"},children:e.jsx(F,{component:x,children:e.jsxs(C,{stickyHeader:!0,size:"small","aria-label":"a dense table",children:[e.jsx(y,{children:e.jsxs(j,{children:[e.jsx(t,{className:r,children:"Test name"}),e.jsx(t,{className:r,children:"Number of failures in the past two weeks"})]})}),e.jsx(v,{children:I.map((s,d)=>e.jsxs(j,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{component:"th",scope:"row",children:s[0]}),e.jsxs(t,{children:[s[1].failures," ",e.jsx(V,{count:s[1].flakyFailures})]})]},d))})]})})}),e.jsx("h3",{className:J,children:"All test failures"}),e.jsxs("div",{className:L,children:[e.jsx(p,{id:"standard-basic",label:"Name",variant:"standard",value:h,onChange:E}),e.jsx(p,{id:"standard-basic",label:"Date from",variant:"standard",value:u,onChange:O}),e.jsx(p,{id:"standard-basic",label:"Date to",variant:"standard",value:m,onChange:P}),e.jsxs("div",{className:U,children:[e.jsx(k,{checked:b,onChange:R}),e.jsx("span",{children:"Include flaky tests"})]})]}),e.jsx(x,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(F,{component:x,children:e.jsxs(C,{stickyHeader:!0,size:"small","aria-label":"a dense table",children:[e.jsx(y,{children:e.jsxs(j,{children:[e.jsx(t,{className:r,children:"#"}),e.jsx(t,{className:r,children:"Test name"}),e.jsx(t,{className:r,children:"Is Flaky"}),e.jsx(t,{className:r,children:"Job"}),e.jsx(t,{className:r,children:"Config"}),e.jsx(t,{className:r,children:"Status"}),e.jsx(t,{className:r,children:"Node"}),e.jsx(t,{className:r,sx:{minWidth:75},children:"Date"}),e.jsx(t,{className:r,children:"Build"}),e.jsx(t,{className:r,children:"Built On"}),e.jsx(t,{className:r,children:"Source"})]})}),e.jsx(v,{children:_.map((s,d)=>e.jsxs(j,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{component:"th",scope:"row",children:d+1}),e.jsx(t,{children:s.testName}),e.jsx(t,{children:f(s)?"Yes":"No"}),e.jsx(t,{children:s.jobName}),e.jsx(t,{children:s.config}),e.jsx(t,{children:s.status}),e.jsx(t,{children:s.nodeVersion}),e.jsx(t,{sx:{minWidth:200},children:new Date(s.timestamp).toISOString()}),e.jsx(t,{children:e.jsx("a",{href:s.buildUrl,target:"_blank",rel:"noreferrer",children:s.buildNumber})}),e.jsx(t,{children:s.builtOn}),e.jsx(t,{children:e.jsx(M,{callStack:s.callStack})})]},d))})]})})})]})};export{K as Tests};
